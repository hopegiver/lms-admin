<div class="analytics-learning">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="mb-1">í•™ìŠµ ë¶„ì„</h4>
            <p class="text-muted mb-0">í•™ìŠµ íŒ¨í„´ê³¼ ì™„ê°•ë¥ ì„ ë¶„ì„í•©ë‹ˆë‹¤</p>
        </div>
        <div class="d-flex gap-2">
            <select class="form-select form-select-sm" style="width: 200px;" v-model="selectedCourse">
                <option v-for="course in courseList" :key="course" :value="course">{{ course }}</option>
            </select>
            <div class="btn-group">
                <button type="button" class="btn btn-sm" :class="dateRange === '7days' ? 'btn-primary' : 'btn-outline-secondary'" @click="changeDateRange('7days')">7ì¼</button>
                <button type="button" class="btn btn-sm" :class="dateRange === '30days' ? 'btn-primary' : 'btn-outline-secondary'" @click="changeDateRange('30days')">30ì¼</button>
                <button type="button" class="btn btn-sm" :class="dateRange === '90days' ? 'btn-primary' : 'btn-outline-secondary'" @click="changeDateRange('90days')">90ì¼</button>
            </div>
        </div>
    </div>

    <!-- í•µì‹¬ í•™ìŠµ ì§€í‘œ -->
    <div class="row g-3 mb-4">
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div class="text-muted small">ì´ ìˆ˜ê°• ë“±ë¡</div>
                        <div class="rounded-circle bg-primary bg-opacity-10 p-2">
                            <span class="fs-5">âœ…</span>
                        </div>
                    </div>
                    <div class="fs-3 fw-bold mb-1">{{ learningMetrics.totalEnrollments }}</div>
                    <div class="small">
                        <span class="text-success">â–² {{ learningMetrics.enrollmentsChange }}%</span>
                        <span class="text-muted ms-1">ì „ì›” ëŒ€ë¹„</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div class="text-muted small">í‰ê·  ì™„ê°•ë¥ </div>
                        <div class="rounded-circle bg-success bg-opacity-10 p-2">
                            <span class="fs-5">ğŸ“</span>
                        </div>
                    </div>
                    <div class="fs-3 fw-bold mb-1">{{ learningMetrics.avgCompletionRate }}</div>
                    <div class="small">
                        <span class="text-success">â–² {{ learningMetrics.completionChange }}%</span>
                        <span class="text-muted ms-1">ì „ì›” ëŒ€ë¹„</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div class="text-muted small">í‰ê·  í•™ìŠµ ì‹œê°„</div>
                        <div class="rounded-circle bg-warning bg-opacity-10 p-2">
                            <span class="fs-5">â°</span>
                        </div>
                    </div>
                    <div class="fs-3 fw-bold mb-1">{{ learningMetrics.avgLearningTime }}</div>
                    <div class="small">
                        <span class="text-success">â–² {{ learningMetrics.timeChange }}ì‹œê°„</span>
                        <span class="text-muted ms-1">ì „ì›” ëŒ€ë¹„</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <div class="text-muted small">ìˆ˜ë£Œì¦ ë°œê¸‰</div>
                        <div class="rounded-circle bg-info bg-opacity-10 p-2">
                            <span class="fs-5">ğŸ“œ</span>
                        </div>
                    </div>
                    <div class="fs-3 fw-bold mb-1">{{ learningMetrics.certificateIssued }}</div>
                    <div class="small">
                        <span class="text-success">â–² {{ learningMetrics.certificateChange }}%</span>
                        <span class="text-muted ms-1">ì „ì›” ëŒ€ë¹„</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í•™ìŠµ íŒ¨í„´ ë¶„ì„ -->
    <div class="row g-4 mb-4">
        <!-- ì‹œê°„ëŒ€ë³„ í•™ìŠµ íŒ¨í„´ -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="card-title mb-4">ì‹œê°„ëŒ€ë³„ í•™ìŠµ íŒ¨í„´</h6>
                    <div class="chart-container" style="height: 250px;">
                        <div class="d-flex align-items-end justify-content-between h-100" style="gap: 4px;">
                            <div v-for="data in learningPatternByHour" :key="data.hour" class="flex-fill text-center">
                                <div class="mb-2">
                                    <div class="bg-info rounded" :style="{ height: getPatternBarHeight(data.count), minHeight: '10px' }"></div>
                                </div>
                                <div class="small text-muted" style="font-size: 0.7rem;">{{ data.hour }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-info mt-3 mb-0">
                        <small>ğŸ’¡ ê°€ì¥ í™œë°œí•œ í•™ìŠµ ì‹œê°„ëŒ€ëŠ” <strong>18-22ì‹œ</strong>ì…ë‹ˆë‹¤.</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- ìš”ì¼ë³„ í•™ìŠµ íŒ¨í„´ -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="card-title mb-4">ìš”ì¼ë³„ í•™ìŠµ íŒ¨í„´</h6>
                    <div class="chart-container" style="height: 250px;">
                        <div class="d-flex align-items-end justify-content-between h-100" style="gap: 8px;">
                            <div v-for="data in learningPatternByDay" :key="data.day" class="flex-fill text-center">
                                <div class="mb-2">
                                    <div class="bg-primary rounded" :style="{ height: getDayBarHeight(data.count), minHeight: '10px' }"></div>
                                </div>
                                <div class="small text-muted">{{ data.day }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-info mt-3 mb-0">
                        <small>ğŸ’¡ ëª©ìš”ì¼ì— ê°€ì¥ ë§ì´ í•™ìŠµí•©ë‹ˆë‹¤.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê°•ì¢Œë³„ ì™„ê°•ë¥  & ë“œë¡­ì•„ì›ƒ ë¶„ì„ -->
    <div class="row g-4 mb-4">
        <!-- ê°•ì¢Œë³„ ì™„ê°•ë¥  -->
        <div class="col-lg-7">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="card-title mb-4">ê°•ì¢Œë³„ ì™„ê°•ë¥  TOP 5</h6>
                    <div class="table-responsive">
                        <table class="table">
                            <thead class="table-light">
                                <tr>
                                    <th>ê°•ì¢Œëª…</th>
                                    <th class="text-center">ìˆ˜ê°•ìƒ</th>
                                    <th class="text-center">ì™„ê°•</th>
                                    <th class="text-center">ì™„ê°•ë¥ </th>
                                    <th>ì§„í–‰ë„</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="course in courseCompletionRates" :key="course.course">
                                    <td class="fw-bold">{{ course.course }}</td>
                                    <td class="text-center">{{ formatNumber(course.enrollments) }}</td>
                                    <td class="text-center">{{ formatNumber(course.completions) }}</td>
                                    <td class="text-center">
                                        <span class="badge" :class="{
                                            'bg-success': course.rate >= 70,
                                            'bg-warning': course.rate >= 60 && course.rate < 70,
                                            'bg-danger': course.rate < 60
                                        }">{{ course.rate }}%</span>
                                    </td>
                                    <td>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar" :class="{
                                                'bg-success': course.rate >= 70,
                                                'bg-warning': course.rate >= 60 && course.rate < 70,
                                                'bg-danger': course.rate < 60
                                            }" :style="{ width: course.progress + '%' }"></div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë“œë¡­ì•„ì›ƒ ë¶„ì„ -->
        <div class="col-lg-5">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="card-title mb-4">ë“œë¡­ì•„ì›ƒ ë¶„ì„ (ì§„ë„ìœ¨ êµ¬ê°„ë³„)</h6>
                    <div style="max-height: 320px; overflow-y: auto;">
                        <div v-for="data in dropoutAnalysis" :key="data.range" class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <span class="small">{{ data.range }}</span>
                                <span class="small fw-bold">{{ data.count }}ëª… ({{ data.percentage }}%)</span>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar" :class="{
                                    'bg-danger': data.range.startsWith('0-') || data.range.startsWith('10-'),
                                    'bg-warning': data.range.startsWith('20-') || data.range.startsWith('30-') || data.range.startsWith('40-'),
                                    'bg-success': data.range.startsWith('90-')
                                }" :style="{ width: data.percentage + '%' }"></div>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-warning mt-3 mb-0">
                        <small>âš ï¸ ì´ˆë°˜ 10% êµ¬ê°„ì—ì„œ ì´íƒˆì´ ë†’ìŠµë‹ˆë‹¤.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í‰ê·  í•™ìŠµ ì‹œê°„ -->
    <div class="card border-0 shadow-sm">
        <div class="card-body">
            <h6 class="card-title mb-4">ê°•ì¢Œë³„ í‰ê·  í•™ìŠµ ì‹œê°„</h6>
            <div class="row g-3">
                <div v-for="data in avgLearningTimeData" :key="data.course" class="col-md-6 col-lg-4">
                    <div class="card border">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="small fw-bold">{{ data.course }}</span>
                                <span class="badge bg-primary">{{ data.time }}ì‹œê°„</span>
                            </div>
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar bg-primary" :style="{ width: (data.time / 10 * 100) + '%' }"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
