<div class="orders-page">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="mb-1">ì£¼ë¬¸</h4>
            <p class="text-muted mb-0">ì£¼ë¬¸ ë‚´ì—­ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
        </div>
        <button class="btn btn-outline-secondary" @click="exportOrders">
            <span class="me-1">ğŸ“¥</span> ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        </button>
    </div>

    <!-- í†µê³„ ì¹´ë“œ -->
    <div class="row g-3 mb-4">
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="text-muted small">ì˜¤ëŠ˜ ì£¼ë¬¸</div>
                            <div class="fs-4 fw-bold">{{ stats.today }}</div>
                        </div>
                        <div class="rounded-circle bg-primary bg-opacity-10 p-3">
                            <span class="fs-4">ğŸ“‹</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="text-muted small">ì²˜ë¦¬ ëŒ€ê¸°</div>
                            <div class="fs-4 fw-bold text-warning">{{ stats.pending }}</div>
                        </div>
                        <div class="rounded-circle bg-warning bg-opacity-10 p-3">
                            <span class="fs-4">â³</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="text-muted small">ì´ë²ˆë‹¬ ë§¤ì¶œ</div>
                            <div class="fs-4 fw-bold text-success">{{ stats.monthlyRevenue }}</div>
                        </div>
                        <div class="rounded-circle bg-success bg-opacity-10 p-3">
                            <span class="fs-4">ğŸ’°</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="text-muted small">í™˜ë¶ˆ ìš”ì²­</div>
                            <div class="fs-4 fw-bold text-danger">{{ stats.refundRequests }}</div>
                        </div>
                        <div class="rounded-circle bg-danger bg-opacity-10 p-3">
                            <span class="fs-4">â†©ï¸</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í•„í„° -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <div class="row g-3 align-items-center">
                <div class="col-md-2">
                    <select class="form-select" v-model="filters.status">
                        <option value="">ì „ì²´ ìƒíƒœ</option>
                        <option value="pending">ê²°ì œëŒ€ê¸°</option>
                        <option value="completed">ê²°ì œì™„ë£Œ</option>
                        <option value="cancelled">ì·¨ì†Œ</option>
                        <option value="refunded">í™˜ë¶ˆì™„ë£Œ</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select class="form-select" v-model="filters.paymentMethod">
                        <option value="">ê²°ì œìˆ˜ë‹¨</option>
                        <option value="card">ì‹ ìš©ì¹´ë“œ</option>
                        <option value="bank">ê³„ì¢Œì´ì²´</option>
                        <option value="virtual">ê°€ìƒê³„ì¢Œ</option>
                        <option value="phone">íœ´ëŒ€í°</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <div class="input-group">
                        <span class="input-group-text bg-white">ğŸ“…</span>
                        <input type="date" class="form-control" v-model="filters.startDate">
                        <input type="date" class="form-control" v-model="filters.endDate">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="input-group">
                        <span class="input-group-text bg-white">ğŸ”</span>
                        <input type="text" class="form-control" placeholder="ì£¼ë¬¸ë²ˆí˜¸, êµ¬ë§¤ìëª…..." v-model="searchQuery">
                    </div>
                </div>
                <div class="col-md-2 text-end">
                    <button class="btn btn-outline-secondary" @click="resetFilters">ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì£¼ë¬¸ ëª©ë¡ -->
    <div class="card border-0 shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="table-light">
                        <tr>
                            <th><input type="checkbox" class="form-check-input"></th>
                            <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                            <th>êµ¬ë§¤ì</th>
                            <th>ìƒí’ˆ</th>
                            <th class="text-end">ê²°ì œê¸ˆì•¡</th>
                            <th>ê²°ì œìˆ˜ë‹¨</th>
                            <th class="text-center">ìƒíƒœ</th>
                            <th>ì£¼ë¬¸ì¼ì‹œ</th>
                            <th style="width: 100px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="order in orders" :key="order.id">
                            <td><input type="checkbox" class="form-check-input"></td>
                            <td><span class="fw-medium text-primary" @click="viewDetail(order)" style="cursor: pointer;">{{ order.orderNo }}</span></td>
                            <td>
                                <div>{{ order.buyer }}</div>
                                <div class="text-muted small">{{ order.email }}</div>
                            </td>
                            <td>
                                <div>{{ order.product }}</div>
                                <div class="text-muted small" v-if="order.additionalItems">ì™¸ {{ order.additionalItems }}ê±´</div>
                            </td>
                            <td class="text-end fw-bold">{{ order.amount }}</td>
                            <td>
                                <span class="badge bg-light text-dark">{{ getPaymentMethodText(order.paymentMethod) }}</span>
                            </td>
                            <td class="text-center">
                                <span class="badge" :class="getStatusBadgeClass(order.status)">
                                    {{ getStatusText(order.status) }}
                                </span>
                            </td>
                            <td>{{ order.orderDate }}</td>
                            <td @click.stop>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-link text-muted" data-bs-toggle="dropdown">â‹®</button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li><a class="dropdown-item" href="#" @click="openOrderDetail(order)">ìƒì„¸ë³´ê¸°</a></li>
                                        <li><a class="dropdown-item" href="#" @click="resendReceipt(order)">ì˜ìˆ˜ì¦ ì¬ë°œì†¡</a></li>
                                        <li v-if="order.status === 'completed'"><hr class="dropdown-divider"></li>
                                        <li v-if="order.status === 'completed'">
                                            <a class="dropdown-item text-danger" href="#" @click="processRefund(order)">í™˜ë¶ˆì²˜ë¦¬</a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    <div class="d-flex justify-content-between align-items-center mt-4">
        <div class="text-muted small">ì´ {{ orders.length }}ê±´</div>
        <nav>
            <ul class="pagination mb-0">
                <li class="page-item disabled"><a class="page-link" href="#">ì´ì „</a></li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link" href="#">ë‹¤ìŒ</a></li>
            </ul>
        </nav>
    </div>
</div>

<!-- ì£¼ë¬¸ ìƒì„¸ ìŠ¬ë¼ì´ë“œ íŒ¨ë„ -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="orderDetailPanel" style="width: 500px;">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title">ì£¼ë¬¸ ìƒì„¸</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body" v-if="selectedOrder">
        <!-- ì£¼ë¬¸ ì •ë³´ -->
        <div class="mb-4">
            <h6 class="mb-3">ì£¼ë¬¸ ì •ë³´</h6>
            <div class="row g-3">
                <div class="col-6">
                    <label class="form-label text-muted small">ì£¼ë¬¸ë²ˆí˜¸</label>
                    <div class="fw-medium">{{ selectedOrder.orderNo }}</div>
                </div>
                <div class="col-6">
                    <label class="form-label text-muted small">ì£¼ë¬¸ì¼ì‹œ</label>
                    <div>{{ selectedOrder.orderDate }}</div>
                </div>
                <div class="col-6">
                    <label class="form-label text-muted small">ê²°ì œìˆ˜ë‹¨</label>
                    <div>{{ getPaymentMethodText(selectedOrder.paymentMethod) }}</div>
                </div>
                <div class="col-6">
                    <label class="form-label text-muted small">ìƒíƒœ</label>
                    <div>
                        <span class="badge" :class="getStatusBadgeClass(selectedOrder.status)">
                            {{ getStatusText(selectedOrder.status) }}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- êµ¬ë§¤ì ì •ë³´ -->
        <div class="mb-4">
            <h6 class="mb-3">êµ¬ë§¤ì ì •ë³´</h6>
            <div class="row g-3">
                <div class="col-6">
                    <label class="form-label text-muted small">ì´ë¦„</label>
                    <div>{{ selectedOrder.buyer }}</div>
                </div>
                <div class="col-6">
                    <label class="form-label text-muted small">ì´ë©”ì¼</label>
                    <div>{{ selectedOrder.email }}</div>
                </div>
            </div>
        </div>

        <!-- ì£¼ë¬¸ ìƒí’ˆ -->
        <div class="mb-4">
            <h6 class="mb-3">ì£¼ë¬¸ ìƒí’ˆ</h6>
            <div class="list-group">
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <div class="fw-medium">{{ selectedOrder.product }}</div>
                        <div class="text-muted small">ê°•ì¢Œ</div>
                    </div>
                    <div class="text-end">
                        <div class="fw-bold">{{ selectedOrder.amount }}</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê²°ì œ ë‚´ì—­ -->
        <div class="mb-4">
            <h6 class="mb-3">ê²°ì œ ë‚´ì—­</h6>
            <div class="bg-light rounded p-3">
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">ìƒí’ˆ ê¸ˆì•¡</span>
                    <span>{{ selectedOrder.amount }}</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">í• ì¸</span>
                    <span class="text-danger">-â‚©0</span>
                </div>
                <hr>
                <div class="d-flex justify-content-between">
                    <span class="fw-bold">ìµœì¢… ê²°ì œê¸ˆì•¡</span>
                    <span class="fw-bold text-primary">{{ selectedOrder.amount }}</span>
                </div>
            </div>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ -->
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary flex-fill" @click="resendReceipt(selectedOrder)">
                ì˜ìˆ˜ì¦ ì¬ë°œì†¡
            </button>
            <button class="btn btn-danger flex-fill" v-if="selectedOrder.status === 'completed'"
                    @click="processRefund(selectedOrder)">
                í™˜ë¶ˆì²˜ë¦¬
            </button>
        </div>
    </div>
</div>
