<div class="permissions-settings-page">
    <!-- 페이지 헤더 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="mb-1">권한 관리</h4>
            <p class="text-muted mb-0">역할별 권한을 설정합니다</p>
        </div>
        <button class="btn btn-primary" @click="openCreateRoleModal">
            <span class="me-1">+</span> 역할 추가
        </button>
    </div>

    <div class="row">
        <!-- 역할 목록 -->
        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0">역할</h6>
                </div>
                <div class="list-group list-group-flush">
                    <a v-for="role in roles" :key="role.id"
                       href="#"
                       class="list-group-item list-group-item-action"
                       :class="{ 'active': selectedRole && selectedRole.id === role.id }"
                       @click.prevent="selectRole(role)">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="fw-medium">{{ role.name }}</div>
                                <div class="text-muted small">{{ role.description }}</div>
                            </div>
                            <span class="badge bg-light text-dark">{{ role.userCount }}명</span>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <!-- 권한 설정 -->
        <div class="col-md-8">
            <div class="card border-0 shadow-sm" v-if="selectedRole">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-0">{{ selectedRole.name }} 권한</h6>
                        <div class="text-muted small">{{ selectedRole.description }}</div>
                    </div>
                    <div>
                        <button class="btn btn-sm btn-outline-danger me-2" @click="deleteRole" v-if="!selectedRole.isSystem">삭제</button>
                        <button class="btn btn-sm btn-primary" @click="savePermissions">저장</button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="accordion" id="permissionAccordion">
                        <div class="accordion-item border-0" v-for="(group, index) in permissionGroups" :key="group.id">
                            <h2 class="accordion-header">
                                <button class="accordion-button" :class="{ 'collapsed': index !== 0 }" type="button" :data-bs-toggle="'collapse'" :data-bs-target="'#collapse' + group.id">
                                    <span class="me-2">{{ group.icon }}</span>
                                    {{ group.name }}
                                    <span class="badge bg-primary ms-2">{{ getGroupPermissionCount(group) }}</span>
                                </button>
                            </h2>
                            <div :id="'collapse' + group.id" class="accordion-collapse collapse" :class="{ 'show': index === 0 }">
                                <div class="accordion-body">
                                    <table class="table table-sm mb-0">
                                        <thead>
                                            <tr>
                                                <th>권한</th>
                                                <th class="text-center" style="width: 80px;">보기</th>
                                                <th class="text-center" style="width: 80px;">생성</th>
                                                <th class="text-center" style="width: 80px;">수정</th>
                                                <th class="text-center" style="width: 80px;">삭제</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="perm in group.permissions" :key="perm.id">
                                                <td>{{ perm.name }}</td>
                                                <td class="text-center">
                                                    <input type="checkbox" class="form-check-input" v-model="selectedRole.permissions[perm.id]" :value="'view'">
                                                </td>
                                                <td class="text-center">
                                                    <input type="checkbox" class="form-check-input" v-model="selectedRole.permissions[perm.id + '_create']">
                                                </td>
                                                <td class="text-center">
                                                    <input type="checkbox" class="form-check-input" v-model="selectedRole.permissions[perm.id + '_edit']">
                                                </td>
                                                <td class="text-center">
                                                    <input type="checkbox" class="form-check-input" v-model="selectedRole.permissions[perm.id + '_delete']">
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card border-0 shadow-sm" v-else>
                <div class="card-body text-center text-muted py-5">
                    왼쪽에서 역할을 선택하세요
                </div>
            </div>
        </div>
    </div>
</div>
