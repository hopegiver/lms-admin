<div class="assessments-detail-page">
    <!-- 페이지 헤더 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <div class="d-flex align-items-center gap-2 mb-2">
                <a href="#" @click.prevent="navigateTo('/learning/assessments')" class="text-muted">
                    ← 평가 목록
                </a>
            </div>
            <h4 class="mb-1">{{ assessment?.title }}</h4>
            <p class="text-muted mb-0">평가 상세 정보</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary" @click="edit">
                수정
            </button>
            <button class="btn btn-outline-danger" @click="deleteAssessment">
                삭제
            </button>
        </div>
    </div>

    <!-- 탭 메뉴 -->
    <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
            <a class="nav-link" :class="{ active: currentTab === 'info' }" href="#" @click.prevent="currentTab = 'info'">기본정보</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" :class="{ active: currentTab === 'questions' }" href="#" @click.prevent="currentTab = 'questions'">문제 목록</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" :class="{ active: currentTab === 'attempts' }" href="#" @click.prevent="currentTab = 'attempts'">응시 현황</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" :class="{ active: currentTab === 'stats' }" href="#" @click.prevent="currentTab = 'stats'">통계</a>
        </li>
    </ul>

    <!-- 기본정보 탭 -->
    <div v-if="currentTab === 'info' && assessment">
        <div class="row">
            <div class="col-lg-8">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="mb-0">평가 정보</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label text-muted small">평가 제목</label>
                                <div class="fw-medium">{{ assessment.title }}</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label text-muted small">연결 강좌</label>
                                <div class="fw-medium">{{ assessment.courseName }}</div>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label text-muted small">유형</label>
                                <div>
                                    <span class="badge bg-light text-dark">{{ getTypeText(assessment.type) }}</span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label text-muted small">상태</label>
                                <div>
                                    <span class="badge" :class="getStatusClass(assessment.status)">
                                        {{ getStatusText(assessment.status) }}
                                    </span>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label text-muted small">합격 점수</label>
                                <div class="fw-medium text-primary">{{ assessment.passingScore }}점</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label text-muted small">제한 시간</label>
                                <div class="fw-medium">{{ assessment.timeLimit }}분</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label text-muted small">총 배점</label>
                                <div class="fw-medium">{{ assessment.totalPoints }}점</div>
                            </div>
                            <div class="col-12">
                                <label class="form-label text-muted small">설명</label>
                                <div class="fw-medium">{{ assessment.description }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 통계 사이드바 -->
            <div class="col-lg-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h6 class="mb-3">평가 통계</h6>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="small text-muted">총 응시</span>
                            <span class="fw-bold fs-5">{{ assessment.totalAttempts }}회</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="small text-muted">평균 점수</span>
                            <span class="fw-bold">{{ assessment.avgScore }}점</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span class="small text-muted">합격률</span>
                            <span class="fw-bold text-success">{{ assessment.passRate }}%</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between">
                            <span class="small text-muted">생성일</span>
                            <span class="fw-medium">{{ assessment.createdAt }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 문제 목록 탭 -->
    <div v-if="currentTab === 'questions'">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom d-flex justify-content-between align-items-center">
                <h5 class="mb-0">문제 목록 ({{ questions.length }}개)</h5>
                <button class="btn btn-sm btn-primary" @click="addQuestion">
                    + 문제 추가
                </button>
            </div>
            <div class="card-body">
                <div class="accordion" id="questionsAccordion">
                    <div class="accordion-item" v-for="(question, index) in questions" :key="question.id">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button"
                                :data-bs-toggle="'collapse'" :data-bs-target="'#question' + index">
                                <div class="d-flex align-items-center gap-3 w-100">
                                    <span class="badge bg-light text-dark">{{ index + 1 }}</span>
                                    <div class="flex-grow-1">
                                        <span class="fw-medium">{{ question.text }}</span>
                                        <span class="badge bg-secondary ms-2">{{ getTypeText(question.type) }}</span>
                                    </div>
                                    <span class="text-primary fw-bold">{{ question.points }}점</span>
                                </div>
                            </button>
                        </h2>
                        <div :id="'question' + index" class="accordion-collapse collapse"
                            data-bs-parent="#questionsAccordion">
                            <div class="accordion-body">
                                <div class="row g-3">
                                    <div class="col-12" v-if="question.options">
                                        <label class="form-label text-muted small">보기</label>
                                        <div v-for="(option, i) in question.options.split('\n')" :key="i">
                                            {{ i + 1 }}. {{ option }}
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label text-muted small">정답</label>
                                        <div class="fw-medium text-success">{{ question.answer }}</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label text-muted small">난이도</label>
                                        <div>
                                            <span class="badge bg-light text-dark">{{ question.difficulty || '중' }}</span>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="btn-group">
                                            <button class="btn btn-sm btn-outline-secondary" @click="editQuestion(question)">수정</button>
                                            <button class="btn btn-sm btn-outline-danger" @click="deleteQuestion(question)">삭제</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 응시 현황 탭 -->
    <div v-if="currentTab === 'attempts'">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0">응시 내역</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>학습자</th>
                                <th>이메일</th>
                                <th class="text-center">점수</th>
                                <th class="text-center">소요시간</th>
                                <th class="text-center">통과 여부</th>
                                <th>응시일</th>
                                <th class="text-center">상세</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="attempt in attempts" :key="attempt.id">
                                <td>{{ attempt.learnerName }}</td>
                                <td>{{ attempt.email }}</td>
                                <td class="text-center">
                                    <span class="fw-bold" :class="attempt.passed ? 'text-success' : 'text-danger'">
                                        {{ attempt.score }}점
                                    </span>
                                </td>
                                <td class="text-center">{{ attempt.duration }}</td>
                                <td class="text-center">
                                    <span class="badge" :class="attempt.passed ? 'bg-success' : 'bg-danger'">
                                        {{ attempt.passed ? '통과' : '미통과' }}
                                    </span>
                                </td>
                                <td>{{ attempt.attemptDate }}</td>
                                <td class="text-center">
                                    <button class="btn btn-sm btn-outline-primary" @click="viewAttempt(attempt)">
                                        상세
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 통계 탭 -->
    <div v-if="currentTab === 'stats'">
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="mb-0">점수 분포</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3" v-for="range in scoreDistribution" :key="range.label">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="small">{{ range.label }}</span>
                                <span class="small fw-bold">{{ range.count }}명 ({{ range.percentage }}%)</span>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar" :style="{ width: range.percentage + '%' }"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white border-bottom">
                        <h5 class="mb-0">문제별 정답률</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3" v-for="(stat, index) in questionStats" :key="index">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="small">문제 {{ index + 1 }}</span>
                                <span class="small fw-bold">{{ stat.correctRate }}%</span>
                            </div>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar" :class="stat.correctRate >= 70 ? 'bg-success' : 'bg-warning'"
                                    :style="{ width: stat.correctRate + '%' }"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
