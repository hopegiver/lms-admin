<div class="webinar-reservations">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="mb-1">í™”ìƒê°•ì˜ ì˜ˆì•½ ê´€ë¦¬</h4>
            <p class="text-muted mb-0">í•™ìƒë“¤ì˜ í™”ìƒê°•ì˜ ì˜ˆì•½ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-primary" @click="goToSchedule">
                <span class="me-1">ğŸ“…</span> ê°•ì‚¬ ìŠ¤ì¼€ì¤„
            </button>
            <button class="btn btn-primary" @click="openCreateModal">
                <span class="me-1">â•</span> ì˜ˆì•½ ìƒì„±
            </button>
        </div>
    </div>

    <!-- í†µê³„ ì¹´ë“œ -->
    <div class="row g-3 mb-4">
        <div class="col-sm-6 col-lg-2">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="text-muted small mb-1">ì „ì²´</div>
                    <div class="fs-3 fw-bold">{{ statusCounts.all }}</div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-2">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="text-muted small mb-1">ëŒ€ê¸°ì¤‘</div>
                    <div class="fs-3 fw-bold text-warning">{{ statusCounts.pending }}</div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-2">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="text-muted small mb-1">í™•ì •</div>
                    <div class="fs-3 fw-bold text-success">{{ statusCounts.confirmed }}</div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-2">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="text-muted small mb-1">ì™„ë£Œ</div>
                    <div class="fs-3 fw-bold text-secondary">{{ statusCounts.completed }}</div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-2">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="text-muted small mb-1">ì·¨ì†Œ</div>
                    <div class="fs-3 fw-bold text-danger">{{ statusCounts.cancelled }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- í•„í„° ë° ê²€ìƒ‰ -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label small">ìƒíƒœ</label>
                    <select class="form-select" v-model="filterStatus">
                        <option value="all">ì „ì²´</option>
                        <option value="pending">ëŒ€ê¸°ì¤‘</option>
                        <option value="confirmed">í™•ì •</option>
                        <option value="completed">ì™„ë£Œ</option>
                        <option value="cancelled">ì·¨ì†Œ</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label small">ê°•ì‚¬</label>
                    <select class="form-select" v-model="filterInstructor">
                        <option value="all">ì „ì²´</option>
                        <option v-for="instructor in instructors" :key="instructor.id" :value="instructor.id">
                            {{ instructor.name }}
                        </option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label small">ê²€ìƒ‰</label>
                    <input
                        type="text"
                        class="form-control"
                        v-model="searchKeyword"
                        placeholder="í•™ìƒëª…, ê°•ì‚¬ëª…, ê°•ì¢Œëª…ìœ¼ë¡œ ê²€ìƒ‰..."
                    >
                </div>
            </div>
        </div>
    </div>

    <!-- ì˜ˆì•½ ëª©ë¡ -->
    <div class="card border-0 shadow-sm">
        <div class="card-body p-0">
            <div v-if="filteredReservations.length === 0" class="text-center text-muted py-5">
                <div class="fs-1 mb-3">ğŸ“­</div>
                <div>ì˜ˆì•½ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
            <div v-else class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>ì˜ˆì•½ ID</th>
                            <th>í•™ìƒ</th>
                            <th>ê°•ì‚¬</th>
                            <th>ê°•ì¢Œ</th>
                            <th>ì¼ì‹œ</th>
                            <th>ì‹œê°„</th>
                            <th>ìƒíƒœ</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="reservation in filteredReservations" :key="reservation.id">
                            <td class="fw-bold">#{{ reservation.id }}</td>
                            <td>
                                <div>{{ reservation.studentName }}</div>
                                <div class="small text-muted">{{ reservation.studentEmail }}</div>
                            </td>
                            <td>{{ reservation.instructorName }}</td>
                            <td>{{ reservation.courseTitle }}</td>
                            <td>
                                <div>{{ formatDate(reservation.dateTime) }}</div>
                                <div class="small text-muted">{{ formatTime(reservation.dateTime) }}</div>
                            </td>
                            <td>{{ reservation.duration }}ë¶„</td>
                            <td>
                                <span class="badge" :class="getStatusBadge(reservation.status).class">
                                    {{ getStatusBadge(reservation.status).text }}
                                </span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" @click="viewDetail(reservation)">
                                    ìƒì„¸
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ì˜ˆì•½ ìƒì„± ëª¨ë‹¬ -->
    <div v-if="showCreateModal" class="modal d-block" tabindex="-1" style="background: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ìƒˆ ì˜ˆì•½ ìƒì„±</h5>
                    <button type="button" class="btn-close" @click="showCreateModal = false"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">ê°•ì‚¬ <span class="text-danger">*</span></label>
                            <select class="form-select" v-model="newReservation.instructorId" required>
                                <option :value="null">ì„ íƒí•˜ì„¸ìš”</option>
                                <option v-for="instructor in instructors" :key="instructor.id" :value="instructor.id">
                                    {{ instructor.name }}
                                </option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label">í•™ìƒ ê²€ìƒ‰ <span class="text-danger">*</span></label>
                            <div class="position-relative">
                                <div class="input-group">
                                    <input
                                        type="text"
                                        class="form-control"
                                        v-model="studentSearchKeyword"
                                        @focus="focusStudentSearch"
                                        @input="showStudentDropdown = true"
                                        placeholder="í•™ìƒ ì´ë¦„, ì´ë©”ì¼, ì „í™”ë²ˆí˜¸ë¡œ ê²€ìƒ‰..."
                                        autocomplete="off"
                                    >
                                    <button
                                        v-if="selectedStudent"
                                        class="btn btn-outline-secondary"
                                        type="button"
                                        @click="clearStudentSelection"
                                    >
                                        âœ•
                                    </button>
                                </div>
                                <div v-if="selectedStudent" class="mt-2 p-2 bg-light rounded border">
                                    <div class="small text-muted">ì„ íƒëœ í•™ìƒ</div>
                                    <div class="fw-bold">{{ selectedStudent.name }}</div>
                                    <div class="small text-muted">{{ selectedStudent.email }} | {{ selectedStudent.phone }}</div>
                                </div>
                                <div
                                    v-if="showStudentDropdown && !selectedStudent && studentSearchKeyword"
                                    class="position-absolute w-100 bg-white border rounded shadow-sm mt-1"
                                    style="max-height: 300px; overflow-y: auto; z-index: 1050;"
                                >
                                    <div v-if="filteredStudents.length === 0" class="p-3 text-center text-muted">
                                        ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤
                                    </div>
                                    <div
                                        v-for="student in filteredStudents"
                                        :key="student.id"
                                        class="p-2 border-bottom hover-bg-light"
                                        style="cursor: pointer;"
                                        @click="selectStudent(student)"
                                    >
                                        <div class="fw-bold">{{ student.name }}</div>
                                        <div class="small text-muted">{{ student.email }} | {{ student.phone }}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <label class="form-label">ê°•ì¢Œëª…</label>
                            <input type="text" class="form-control" v-model="newReservation.courseTitle" placeholder="ì˜ˆ: Vue.js ì‹¬í™” ê³¼ì • (ì„ íƒì‚¬í•­)">
                        </div>
                        <div class="col-md-8">
                            <label class="form-label">ì˜ˆì•½ ì¼ì‹œ <span class="text-danger">*</span></label>
                            <input type="datetime-local" class="form-control" v-model="newReservation.dateTime" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">ì†Œìš” ì‹œê°„</label>
                            <select class="form-select" v-model="newReservation.duration">
                                <option :value="30">30ë¶„</option>
                                <option :value="60">60ë¶„</option>
                                <option :value="90">90ë¶„</option>
                                <option :value="120">120ë¶„</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label">ìš”ì²­ ì‚¬í•­</label>
                            <textarea class="form-control" v-model="newReservation.notes" rows="3" placeholder="í•™ìƒì˜ ìš”ì²­ ì‚¬í•­ì´ë‚˜ ìƒë‹´ ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @click="showCreateModal = false">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" @click="createReservation">ìƒì„±</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ì˜ˆì•½ ìƒì„¸ ëª¨ë‹¬ -->
    <div v-if="showDetailModal && selectedReservation" class="modal d-block" tabindex="-1" style="background: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ì˜ˆì•½ ìƒì„¸ #{{ selectedReservation.id }}</h5>
                    <button type="button" class="btn-close" @click="showDetailModal = false"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">ìƒíƒœ</label>
                                <div>
                                    <span class="badge fs-6" :class="getStatusBadge(selectedReservation.status).class">
                                        {{ getStatusBadge(selectedReservation.status).text }}
                                    </span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">í•™ìƒ</label>
                                <div class="fw-bold">{{ selectedReservation.studentName }}</div>
                                <div class="text-muted">{{ selectedReservation.studentEmail }}</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">ê°•ì‚¬</label>
                                <div class="fw-bold">{{ selectedReservation.instructorName }}</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">ê°•ì¢Œ</label>
                                <div class="fw-bold">{{ selectedReservation.courseTitle }}</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">ì˜ˆì•½ ì¼ì‹œ</label>
                                <div class="fw-bold">{{ formatDateTime(selectedReservation.dateTime) }}</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">ì†Œìš” ì‹œê°„</label>
                                <div class="fw-bold">{{ selectedReservation.duration }}ë¶„</div>
                            </div>
                        </div>
                        <div class="col-12" v-if="selectedReservation.meetingUrl">
                            <div class="mb-3">
                                <label class="form-label text-muted small">íšŒì˜ ë§í¬</label>
                                <div>
                                    <a :href="selectedReservation.meetingUrl" target="_blank" class="btn btn-sm btn-primary">
                                        <span class="me-1">ğŸ”—</span> íšŒì˜ ì°¸ì—¬
                                    </a>
                                    <button class="btn btn-sm btn-outline-secondary ms-2" @click="navigator.clipboard.writeText(selectedReservation.meetingUrl)">
                                        ë³µì‚¬
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-12" v-if="selectedReservation.notes">
                            <div class="mb-3">
                                <label class="form-label text-muted small">ìš”ì²­ ì‚¬í•­</label>
                                <div class="border rounded p-3 bg-light">{{ selectedReservation.notes }}</div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="mb-3">
                                <label class="form-label text-muted small">ìƒì„± ì¼ì‹œ</label>
                                <div class="text-muted">{{ formatDateTime(selectedReservation.createdAt) }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer d-flex justify-content-between">
                    <button type="button" class="btn btn-outline-danger" @click="deleteReservation(selectedReservation.id)">
                        ì‚­ì œ
                    </button>
                    <div class="d-flex gap-2">
                        <button
                            v-if="selectedReservation.status === 'pending'"
                            type="button"
                            class="btn btn-success"
                            @click="confirmReservation(selectedReservation)"
                        >
                            í™•ì •
                        </button>
                        <button
                            v-if="selectedReservation.status === 'confirmed'"
                            type="button"
                            class="btn btn-primary"
                            @click="completeReservation(selectedReservation)"
                        >
                            ì™„ë£Œ ì²˜ë¦¬
                        </button>
                        <button
                            v-if="selectedReservation.status === 'pending' || selectedReservation.status === 'confirmed'"
                            type="button"
                            class="btn btn-outline-danger"
                            @click="cancelReservation(selectedReservation)"
                        >
                            ì·¨ì†Œ
                        </button>
                        <button type="button" class="btn btn-secondary" @click="showDetailModal = false">ë‹«ê¸°</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
