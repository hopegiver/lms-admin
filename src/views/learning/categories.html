<div class="categories-page">
    <!-- ÌéòÏù¥ÏßÄ Ìó§Îçî -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <div class="d-flex align-items-center gap-2 mb-2">
                <a href="#" @click.prevent="navigateTo('/learning/courses')" class="text-muted">
                    ‚Üê Í∞ïÏ¢å Î™©Î°ù
                </a>
            </div>
            <h4 class="mb-1">Ïπ¥ÌÖåÍ≥†Î¶¨ Í¥ÄÎ¶¨</h4>
            <p class="text-muted mb-0">Í∞ïÏ¢å Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏÉùÏÑ±ÌïòÍ≥† Í¥ÄÎ¶¨Ìï©ÎãàÎã§</p>
        </div>
        <button class="btn btn-primary" @click="openAddModal(null)">
            <span class="me-1">‚ûï</span> ÎåÄÎ∂ÑÎ•ò Ï∂îÍ∞Ä
        </button>
    </div>

    <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ Ìä∏Î¶¨ -->
    <div class="card border-0 shadow-sm">
        <div class="card-body p-0">
            <div v-if="categories.length === 0" class="text-center text-muted py-5">
                <div class="fs-1 mb-3">üìÅ</div>
                <div>Îì±Î°ùÎêú Ïπ¥ÌÖåÍ≥†Î¶¨Í∞Ä ÏóÜÏäµÎãàÎã§</div>
            </div>
            <div v-else class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 50%;">Ïπ¥ÌÖåÍ≥†Î¶¨Î™Ö</th>
                            <th class="text-center">Í∞ïÏ¢å Ïàò</th>
                            <th class="text-center">ÏàúÏÑú</th>
                            <th class="text-center">ÌëúÏãú</th>
                            <th style="width: 200px;">ÏûëÏóÖ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template v-for="category in sortedCategories" :key="category.id">
                            <!-- ÎåÄÎ∂ÑÎ•ò -->
                            <tr v-if="!category.parentId">
                                <td>
                                    <div class="d-flex align-items-center">
                                        <button
                                            class="btn btn-sm btn-link text-muted p-0 me-2"
                                            @click="toggleExpand(category.id)"
                                            v-if="getChildren(category.id).length > 0"
                                        >
                                            <span v-if="expandedIds.includes(category.id)">‚ñº</span>
                                            <span v-else>‚ñ∂</span>
                                        </button>
                                        <span v-else class="me-4"></span>
                                        <strong>{{ category.name }}</strong>
                                    </div>
                                </td>
                                <td class="text-center">{{ category.courseCount || 0 }}</td>
                                <td class="text-center">
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-secondary" @click="moveCategory(category, 'up')" :disabled="isFirst(category)">‚Üë</button>
                                        <button class="btn btn-outline-secondary" @click="moveCategory(category, 'down')" :disabled="isLast(category)">‚Üì</button>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="form-check form-switch d-inline-block">
                                        <input class="form-check-input" type="checkbox" v-model="category.isVisible" @change="updateCategory(category)">
                                    </div>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary me-1" @click="openAddModal(category.id)">
                                        <span class="me-1">‚ûï</span> ÌïòÏúÑ Ï∂îÍ∞Ä
                                    </button>
                                    <button class="btn btn-sm btn-outline-secondary me-1" @click="openEditModal(category)">ÏàòÏ†ï</button>
                                    <button class="btn btn-sm btn-outline-danger" @click="deleteCategory(category)">ÏÇ≠Ï†ú</button>
                                </td>
                            </tr>

                            <!-- Ï§ëÎ∂ÑÎ•ò (ÌïòÏúÑ Ïπ¥ÌÖåÍ≥†Î¶¨) -->
                            <template v-if="expandedIds.includes(category.id)">
                                <tr v-for="child in getChildren(category.id)" :key="child.id" class="table-secondary">
                                    <td>
                                        <div class="d-flex align-items-center ps-5">
                                            <span class="me-2 text-muted">‚Üí</span>
                                            {{ child.name }}
                                        </div>
                                    </td>
                                    <td class="text-center">{{ child.courseCount || 0 }}</td>
                                    <td class="text-center">
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-secondary" @click="moveCategory(child, 'up')" :disabled="isFirst(child)">‚Üë</button>
                                            <button class="btn btn-outline-secondary" @click="moveCategory(child, 'down')" :disabled="isLast(child)">‚Üì</button>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <div class="form-check form-switch d-inline-block">
                                            <input class="form-check-input" type="checkbox" v-model="child.isVisible" @change="updateCategory(child)">
                                        </div>
                                    </td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-secondary me-1" @click="openEditModal(child)">ÏàòÏ†ï</button>
                                        <button class="btn btn-sm btn-outline-danger" @click="deleteCategory(child)">ÏÇ≠Ï†ú</button>
                                    </td>
                                </tr>
                            </template>
                        </template>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÍ∞Ä/ÏàòÏ†ï Î™®Îã¨ -->
    <div v-if="showModal" class="modal d-block" tabindex="-1" style="background: rgba(0,0,0,0.5);">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{ editingCategory ? 'Ïπ¥ÌÖåÍ≥†Î¶¨ ÏàòÏ†ï' : 'Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÍ∞Ä' }}</h5>
                    <button type="button" class="btn-close" @click="showModal = false"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3" v-if="modalParentId">
                        <label class="form-label">ÏÉÅÏúÑ Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                        <input type="text" class="form-control" :value="getParentName(modalParentId)" disabled>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Ïπ¥ÌÖåÍ≥†Î¶¨Î™Ö <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" v-model="categoryForm.name" placeholder="Ïπ¥ÌÖåÍ≥†Î¶¨Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ÏÑ§Î™Ö</label>
                        <textarea class="form-control" rows="3" v-model="categoryForm.description" placeholder="Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê ÎåÄÌïú ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (ÏÑ†ÌÉùÏÇ¨Ìï≠)"></textarea>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" v-model="categoryForm.isVisible" id="isVisible">
                            <label class="form-check-label" for="isVisible">
                                ÌëúÏãú
                            </label>
                        </div>
                        <div class="form-text">Ï≤¥ÌÅ¨ Ìï¥Ï†ú Ïãú ÏÇ¨Ïö©Ïûê ÌéòÏù¥ÏßÄÏóêÏÑú Ïà®Í≤®ÏßëÎãàÎã§</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @click="showModal = false">Ï∑®ÏÜå</button>
                    <button type="button" class="btn btn-primary" @click="saveCategory">
                        {{ editingCategory ? 'ÏàòÏ†ï' : 'Ï∂îÍ∞Ä' }}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
