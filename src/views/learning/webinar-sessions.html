<div class="webinar-sessions">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="mb-1">ì„¸ì…˜ ì´ë ¥</h4>
            <p class="text-muted mb-0">ì™„ë£Œëœ í™”ìƒê°•ì˜ ì„¸ì…˜ ê¸°ë¡ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</p>
        </div>
        <button class="btn btn-outline-primary" @click="exportData">
            <span class="me-1">ğŸ“Š</span> ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        </button>
    </div>

    <!-- í†µê³„ ì¹´ë“œ -->
    <div class="row g-3 mb-4">
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="text-muted small mb-1">ì „ì²´ ì„¸ì…˜</div>
                    <div class="fs-3 fw-bold">{{ statistics.total }}</div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="text-muted small mb-1">ì¶œì„</div>
                    <div class="fs-3 fw-bold text-success">{{ statistics.attended }}</div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="text-muted small mb-1">ëˆ„ì  ì‹œê°„</div>
                    <div class="fs-3 fw-bold text-primary">{{ statistics.totalHours }}h</div>
                </div>
            </div>
        </div>
        <div class="col-sm-6 col-lg-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="text-muted small mb-1">í‰ê·  í‰ì </div>
                    <div class="fs-3 fw-bold text-warning">{{ statistics.avgRating }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- í•„í„° ë° ê²€ìƒ‰ -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label small">ê¸°ê°„</label>
                    <select class="form-select" v-model="filterPeriod">
                        <option value="7days">ìµœê·¼ 7ì¼</option>
                        <option value="30days">ìµœê·¼ 30ì¼</option>
                        <option value="90days">ìµœê·¼ 90ì¼</option>
                        <option value="all">ì „ì²´</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label small">ê°•ì‚¬</label>
                    <select class="form-select" v-model="filterInstructor">
                        <option value="all">ì „ì²´</option>
                        <option v-for="instructor in instructors" :key="instructor.id" :value="instructor.id">
                            {{ instructor.name }}
                        </option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label small">ê²€ìƒ‰</label>
                    <input
                        type="text"
                        class="form-control"
                        v-model="searchKeyword"
                        placeholder="í•™ìƒëª…, ê°•ì‚¬ëª…, ê°•ì¢Œëª…ìœ¼ë¡œ ê²€ìƒ‰..."
                    >
                </div>
            </div>
        </div>
    </div>

    <!-- ì„¸ì…˜ ëª©ë¡ -->
    <div class="card border-0 shadow-sm">
        <div class="card-body p-0">
            <div v-if="filteredSessions.length === 0" class="text-center text-muted py-5">
                <div class="fs-1 mb-3">ğŸ“­</div>
                <div>ì„¸ì…˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
            </div>
            <div v-else class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>ì„¸ì…˜ ID</th>
                            <th>í•™ìƒ</th>
                            <th>ê°•ì‚¬</th>
                            <th>ê°•ì¢Œ</th>
                            <th>ì¼ì‹œ</th>
                            <th>ì†Œìš”ì‹œê°„</th>
                            <th>ì¶œì„</th>
                            <th>í‰ì </th>
                            <th>ë…¹í™”</th>
                            <th>ê°•ì‚¬ í”¼ë“œë°±</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="session in filteredSessions" :key="session.id">
                            <td class="fw-bold">#{{ session.id }}</td>
                            <td>{{ session.studentName }}</td>
                            <td>{{ session.instructorName }}</td>
                            <td>{{ session.courseTitle }}</td>
                            <td>
                                <div>{{ formatDate(session.startTime) }}</div>
                                <div class="small text-muted">{{ formatTime(session.startTime) }}</div>
                            </td>
                            <td>{{ session.actualDuration }}ë¶„</td>
                            <td>
                                <span class="badge" :class="getAttendanceBadge(session.attendanceStatus).class">
                                    {{ getAttendanceBadge(session.attendanceStatus).text }}
                                </span>
                            </td>
                            <td>
                                <span v-if="session.rating">{{ getRatingStars(session.rating) }}</span>
                                <span v-else class="text-muted">-</span>
                            </td>
                            <td>
                                <button
                                    v-if="session.recordingUrl"
                                    class="btn btn-sm btn-outline-primary"
                                    @click="downloadRecording(session.recordingUrl)"
                                >
                                    <span>ğŸ“¹</span>
                                </button>
                                <span v-else class="text-muted">-</span>
                            </td>
                            <td>
                                <button
                                    v-if="session.attendanceStatus === 'attended'"
                                    class="btn btn-sm"
                                    :class="session.instructorFeedback ? 'btn-success' : 'btn-outline-secondary'"
                                    @click="openFeedbackModal(session)"
                                >
                                    <span v-if="session.instructorFeedback">âœ“</span>
                                    <span v-else>âœï¸</span>
                                </button>
                                <span v-else class="text-muted">-</span>
                            </td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" @click="viewDetail(session)">
                                    ìƒì„¸
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ì„¸ì…˜ ìƒì„¸ ëª¨ë‹¬ -->
    <div v-if="showDetailModal && selectedSession" class="modal d-block" tabindex="-1" style="background: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ì„¸ì…˜ ìƒì„¸ #{{ selectedSession.id }}</h5>
                    <button type="button" class="btn-close" @click="showDetailModal = false"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">ì˜ˆì•½ ID</label>
                                <div class="fw-bold">#{{ selectedSession.reservationId }}</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">í•™ìƒ</label>
                                <div class="fw-bold">{{ selectedSession.studentName }}</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">ê°•ì‚¬</label>
                                <div class="fw-bold">{{ selectedSession.instructorName }}</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">ê°•ì¢Œ</label>
                                <div class="fw-bold">{{ selectedSession.courseTitle }}</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted small">ì‹œì‘ ì‹œê°„</label>
                                <div class="fw-bold">{{ formatDateTime(selectedSession.startTime) }}</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">ì¢…ë£Œ ì‹œê°„</label>
                                <div class="fw-bold">{{ formatDateTime(selectedSession.endTime) }}</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">ì†Œìš” ì‹œê°„</label>
                                <div>
                                    <span class="fw-bold">{{ selectedSession.actualDuration }}ë¶„</span>
                                    <span class="text-muted ms-2">(ì˜ˆì •: {{ selectedSession.duration }}ë¶„)</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small">ì¶œì„ ìƒíƒœ</label>
                                <div>
                                    <span class="badge fs-6" :class="getAttendanceBadge(selectedSession.attendanceStatus).class">
                                        {{ getAttendanceBadge(selectedSession.attendanceStatus).text }}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-12" v-if="selectedSession.recordingUrl">
                            <div class="mb-3">
                                <label class="form-label text-muted small">ë…¹í™” ì˜ìƒ</label>
                                <div>
                                    <button class="btn btn-primary" @click="downloadRecording(selectedSession.recordingUrl)">
                                        <span class="me-1">ğŸ“¹</span> ë…¹í™” ì˜ìƒ ë³´ê¸°
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-12" v-if="selectedSession.notes">
                            <div class="mb-3">
                                <label class="form-label text-muted small">ê°•ì‚¬ ë…¸íŠ¸</label>
                                <div class="border rounded p-3 bg-light">{{ selectedSession.notes }}</div>
                            </div>
                        </div>
                        <div class="col-12" v-if="selectedSession.rating">
                            <div class="mb-3">
                                <label class="form-label text-muted small">í•™ìƒ í‰ê°€</label>
                                <div class="mb-2">
                                    <span class="fs-4">{{ getRatingStars(selectedSession.rating) }}</span>
                                    <span class="text-muted ms-2">({{ selectedSession.rating }}/5)</span>
                                </div>
                                <div v-if="selectedSession.feedback" class="border rounded p-3 bg-light">
                                    {{ selectedSession.feedback }}
                                </div>
                            </div>
                        </div>
                        <div class="col-12" v-if="selectedSession.instructorFeedback">
                            <hr>
                            <h6 class="mb-3">ê°•ì‚¬ í”¼ë“œë°±</h6>
                            <div class="mb-3">
                                <label class="form-label text-muted small fw-bold">í•™ìŠµ ë‚´ìš©</label>
                                <div class="border rounded p-3 bg-light" style="white-space: pre-line;">{{ selectedSession.instructorFeedback.learningContent }}</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small fw-bold">ê°•ì‚¬ ì½”ë©˜íŠ¸</label>
                                <div class="border rounded p-3 bg-light" style="white-space: pre-line;">{{ selectedSession.instructorFeedback.comments }}</div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted small fw-bold">í•™ìŠµ ê²°ê³¼</label>
                                <div>
                                    <span class="badge fs-6" :class="{
                                        'bg-success': selectedSession.instructorFeedback.results === 'ìš°ìˆ˜',
                                        'bg-primary': selectedSession.instructorFeedback.results === 'ì–‘í˜¸',
                                        'bg-secondary': selectedSession.instructorFeedback.results === 'ë³´í†µ',
                                        'bg-warning': selectedSession.instructorFeedback.results === 'ë¯¸í¡'
                                    }">
                                        {{ selectedSession.instructorFeedback.results }}
                                    </span>
                                </div>
                            </div>
                            <div class="mb-3" v-if="selectedSession.instructorFeedback.homework">
                                <label class="form-label text-muted small fw-bold">ê³¼ì œ</label>
                                <div class="border rounded p-3 bg-light" style="white-space: pre-line;">{{ selectedSession.instructorFeedback.homework }}</div>
                            </div>
                            <div class="mb-3" v-if="selectedSession.instructorFeedback.nextTopics">
                                <label class="form-label text-muted small fw-bold">ë‹¤ìŒ í•™ìŠµ ì£¼ì œ</label>
                                <div class="border rounded p-3 bg-light" style="white-space: pre-line;">{{ selectedSession.instructorFeedback.nextTopics }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button v-if="selectedSession.attendanceStatus === 'attended'" type="button" class="btn btn-primary" @click="showDetailModal = false; openFeedbackModal(selectedSession)">
                        <span class="me-1">âœï¸</span> í”¼ë“œë°± {{ selectedSession.instructorFeedback ? 'ìˆ˜ì •' : 'ì‘ì„±' }}
                    </button>
                    <button type="button" class="btn btn-secondary" @click="showDetailModal = false">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ê°•ì‚¬ í”¼ë“œë°± ì‘ì„±/ìˆ˜ì • ëª¨ë‹¬ -->
    <div v-if="showFeedbackModal && selectedSession" class="modal d-block" tabindex="-1" style="background: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ê°•ì‚¬ í”¼ë“œë°± {{ selectedSession.instructorFeedback ? 'ìˆ˜ì •' : 'ì‘ì„±' }}</h5>
                    <button type="button" class="btn-close" @click="showFeedbackModal = false"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <div class="text-muted small mb-2">
                            ì„¸ì…˜: #{{ selectedSession.id }} | {{ selectedSession.studentName }} - {{ selectedSession.courseTitle }}
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">í•™ìŠµ ë‚´ìš© <span class="text-danger">*</span></label>
                        <textarea
                            class="form-control"
                            v-model="feedbackForm.learningContent"
                            rows="4"
                            placeholder="ì´ë²ˆ ì„¸ì…˜ì—ì„œ ë‹¤ë£¬ ì£¼ìš” í•™ìŠµ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."
                        ></textarea>
                        <div class="form-text">ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ì‘ì„±í•˜ë©´ ë³´ê¸° ì¢‹ìŠµë‹ˆë‹¤.</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">ê°•ì‚¬ ì½”ë©˜íŠ¸</label>
                        <textarea
                            class="form-control"
                            v-model="feedbackForm.comments"
                            rows="3"
                            placeholder="í•™ìƒì˜ í•™ìŠµ íƒœë„, ì´í•´ë„, íŠ¹ì´ì‚¬í•­ ë“±ì„ ì…ë ¥í•˜ì„¸ìš”..."
                        ></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">í•™ìŠµ ê²°ê³¼</label>
                        <select class="form-select" v-model="feedbackForm.results">
                            <option value="ìš°ìˆ˜">ìš°ìˆ˜</option>
                            <option value="ì–‘í˜¸">ì–‘í˜¸</option>
                            <option value="ë³´í†µ">ë³´í†µ</option>
                            <option value="ë¯¸í¡">ë¯¸í¡</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">ê³¼ì œ</label>
                        <textarea
                            class="form-control"
                            v-model="feedbackForm.homework"
                            rows="2"
                            placeholder="ë‹¤ìŒ ì„¸ì…˜ê¹Œì§€ ìˆ˜í–‰í•  ê³¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                        ></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">ë‹¤ìŒ í•™ìŠµ ì£¼ì œ</label>
                        <textarea
                            class="form-control"
                            v-model="feedbackForm.nextTopics"
                            rows="2"
                            placeholder="ë‹¤ìŒ ì„¸ì…˜ì—ì„œ ë‹¤ë£° ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
                        ></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @click="showFeedbackModal = false">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" @click="saveFeedback">
                        <span class="me-1">ğŸ’¾</span> ì €ì¥
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
