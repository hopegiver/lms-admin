<div class="courses-wizard-page">
    <!-- í—¤ë” -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="mb-1">ğŸª„ ê°•ì¢Œ ê°„í¸ ìƒì„±</h4>
            <p class="text-muted mb-0">ë‹¨ê³„ë³„ë¡œ ì§„í–‰í•˜ì—¬ ê°•ì¢Œë¥¼ ì‰½ê²Œ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary" @click="saveDraft">
                ğŸ’¾ ì„ì‹œ ì €ì¥
            </button>
            <button class="btn btn-outline-danger" @click="cancel">
                ì·¨ì†Œ
            </button>
        </div>
    </div>

    <!-- ì§„í–‰ë¥  í‘œì‹œ -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <div class="fw-bold">{{ getStepTitle(currentStep) }}</div>
                <div class="text-muted small">{{ currentStep }} / {{ totalSteps }}</div>
            </div>
            <div class="progress" style="height: 8px;">
                <div class="progress-bar" :style="{ width: progressPercentage + '%' }"></div>
            </div>
            <div class="d-flex justify-content-between mt-3">
                <div v-for="step in totalSteps" :key="step"
                     class="wizard-step-indicator"
                     :class="{ 'active': step === currentStep, 'completed': step < currentStep }"
                     @click="goToStep(step)">
                    <div class="step-number">{{ getStepIcon(step) }}</div>
                    <div class="step-label small">{{ getStepTitle(step) }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë‹¨ê³„ë³„ ì»¨í…ì¸  -->
    <div class="wizard-content">
        <!-- 1ë‹¨ê³„: ê¸°ë³¸ ì •ë³´ -->
        <div v-if="currentStep === 1" class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">ğŸ“‹ ê°•ì¢Œ ê¸°ë³¸ ì •ë³´</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-12">
                        <label class="form-label">ê°•ì¢Œëª… *</label>
                        <input type="text" class="form-control" v-model="basicInfo.title" placeholder="ì˜ˆ: React ì™„ë²½ ê°€ì´ë“œ">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">ì¹´í…Œê³ ë¦¬ *</label>
                        <select class="form-select" v-model="basicInfo.category">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option v-for="cat in categories" :key="cat">{{ cat }}</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">ë‚œì´ë„ *</label>
                        <select class="form-select" v-model="basicInfo.level">
                            <option value="beginner">ì´ˆê¸‰</option>
                            <option value="intermediate">ì¤‘ê¸‰</option>
                            <option value="advanced">ê³ ê¸‰</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">ê°•ì‚¬ëª… *</label>
                        <input type="text" class="form-control" v-model="basicInfo.instructor" placeholder="ê°•ì‚¬ ì´ë¦„">
                    </div>
                    <div class="col-12">
                        <label class="form-label">ê°•ì¢Œ ì„¤ëª…</label>
                        <textarea class="form-control" v-model="basicInfo.description" rows="4" placeholder="ê°•ì¢Œì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <div class="col-12">
                        <label class="form-label">ì¸ë„¤ì¼ ì´ë¯¸ì§€</label>
                        <div v-if="basicInfo.thumbnail" class="mb-2">
                            <img :src="basicInfo.thumbnail" class="img-thumbnail" style="max-width: 200px;">
                            <button class="btn btn-sm btn-outline-danger ms-2" @click="removeThumbnail">ì œê±°</button>
                        </div>
                        <button v-else class="btn btn-outline-secondary" @click="uploadThumbnail">
                            ğŸ“ ì´ë¯¸ì§€ ì—…ë¡œë“œ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2ë‹¨ê³„: ì»¤ë¦¬í˜ëŸ¼ êµ¬ì„± -->
        <div v-if="currentStep === 2" class="card border-0 shadow-sm">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">ğŸ“š ì»¤ë¦¬í˜ëŸ¼ êµ¬ì„±</h5>
                <button class="btn btn-primary btn-sm" @click="showAddSectionForm">
                    â• ì„¹ì…˜ ì¶”ê°€
                </button>
            </div>
            <div class="card-body">
                <div v-if="sections.length === 0" class="text-center py-5 text-muted">
                    <div class="mb-3" style="font-size: 3rem;">ğŸ“š</div>
                    <p>ì•„ì§ ì„¹ì…˜ì´ ì—†ìŠµë‹ˆë‹¤. ì„¹ì…˜ì„ ì¶”ê°€í•˜ì—¬ ì»¤ë¦¬í˜ëŸ¼ì„ êµ¬ì„±í•˜ì„¸ìš”.</p>
                    <button class="btn btn-primary" @click="showAddSectionForm">ì²« ì„¹ì…˜ ì¶”ê°€í•˜ê¸°</button>
                </div>

                <div v-else>
                    <div v-for="(section, sIndex) in sections" :key="sIndex" class="card mb-3">
                        <div class="card-header bg-light d-flex justify-content-between align-items-center">
                            <div>
                                <strong>{{ section.title }}</strong>
                                <span v-if="section.description" class="text-muted small ms-2">{{ section.description }}</span>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-outline-primary" @click="addLessonToSection(sIndex)">
                                    â• ì°¨ì‹œ
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" @click="editSection(sIndex)">
                                    âœï¸
                                </button>
                                <button class="btn btn-sm btn-outline-danger" @click="deleteSection(sIndex)">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div v-if="!section.lessons || section.lessons.length === 0" class="text-muted small">
                                ì°¨ì‹œê°€ ì—†ìŠµë‹ˆë‹¤. ì°¨ì‹œë¥¼ ì¶”ê°€í•˜ì„¸ìš”.
                            </div>
                            <div v-else class="list-group">
                                <div v-for="(lesson, lIndex) in section.lessons" :key="lIndex"
                                     class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="me-2">{{ lIndex + 1 }}.</span>
                                        <strong>{{ lesson.title }}</strong>
                                        <span class="text-muted small ms-2">({{ lesson.duration }})</span>
                                    </div>
                                    <button class="btn btn-sm btn-outline-danger" @click="removeLessonFromSection(sIndex, lIndex)">
                                        ğŸ—‘ï¸
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <strong>ğŸ’¡ íŒ:</strong> ì´ {{ sections.length }}ê°œ ì„¹ì…˜, {{ totalLessons }}ê°œ ì°¨ì‹œê°€ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
                    </div>
                </div>

                <!-- ì„¹ì…˜ ì¶”ê°€/ìˆ˜ì • í¼ -->
                <div v-if="showSectionForm" class="modal d-block" style="background: rgba(0,0,0,0.5);">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">{{ editingSectionIndex !== null ? 'ì„¹ì…˜ ìˆ˜ì •' : 'ìƒˆ ì„¹ì…˜ ì¶”ê°€' }}</h5>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label class="form-label">ì„¹ì…˜ëª… *</label>
                                    <input type="text" class="form-control" v-model="tempSectionForm.title" placeholder="ì˜ˆ: React ì‹œì‘í•˜ê¸°">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">ì„¤ëª…</label>
                                    <input type="text" class="form-control" v-model="tempSectionForm.description" placeholder="ì„¹ì…˜ ì„¤ëª… (ì„ íƒì‚¬í•­)">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-outline-secondary" @click="cancelSectionForm">ì·¨ì†Œ</button>
                                <button class="btn btn-primary" @click="saveSectionForm">
                                    {{ editingSectionIndex !== null ? 'ìˆ˜ì •' : 'ì¶”ê°€' }}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3ë‹¨ê³„: ì½˜í…ì¸  ì—°ê²° -->
        <div v-if="currentStep === 3" class="card border-0 shadow-sm">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">ğŸ¬ ì½˜í…ì¸  ì—°ê²°</h5>
                <button class="btn btn-outline-primary btn-sm" @click="createNewContent">
                    â• ìƒˆ ì½˜í…ì¸  ë§Œë“¤ê¸°
                </button>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-4">
                    <strong>â„¹ï¸ ì•ˆë‚´:</strong> ê° ì°¨ì‹œì— ì½˜í…ì¸ ë¥¼ ì—°ê²°í•˜ì„¸ìš”. ë‚˜ì¤‘ì— ì¶”ê°€í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
                </div>

                <div v-for="(section, sIndex) in sections" :key="sIndex" class="mb-4">
                    <h6 class="fw-bold mb-3">{{ section.title }}</h6>
                    <div v-if="section.lessons && section.lessons.length > 0" class="list-group">
                        <div v-for="(lesson, lIndex) in section.lessons" :key="lIndex" class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <strong>{{ lesson.title }}</strong>
                                <span v-if="lesson.contentId" class="badge bg-success">ì—°ê²°ë¨</span>
                                <span v-else class="badge bg-secondary">ë¯¸ì—°ê²°</span>
                            </div>
                            <select class="form-select form-select-sm"
                                    :value="lesson.contentId"
                                    @change="assignContentToLesson(sIndex, lIndex, parseInt($event.target.value))">
                                <option :value="null">ì½˜í…ì¸  ì„ íƒ...</option>
                                <option v-for="content in availableContents" :key="content.id" :value="content.id">
                                    {{ content.title }} ({{ content.type }}, {{ content.duration }})
                                </option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4ë‹¨ê³„: í‰ê°€ ì„¤ì • -->
        <div v-if="currentStep === 4" class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">ğŸ“ í‰ê°€ ì„¤ì • (ì„ íƒì‚¬í•­)</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning mb-4">
                    <strong>ğŸ’¡ ì°¸ê³ :</strong> í‰ê°€ëŠ” ì„ íƒì‚¬í•­ì…ë‹ˆë‹¤. ë‚˜ì¤‘ì— ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>

                <h6 class="mb-3">ì‹œí—˜</h6>
                <div class="row g-3 mb-4">
                    <div v-for="exam in availableExams" :key="exam.id" class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"
                                           :checked="assessments.exams.includes(exam.id)"
                                           @change="$event.target.checked ? addExam(exam.id) : removeExam(exam.id)">
                                    <label class="form-check-label">
                                        <strong>{{ exam.title }}</strong><br>
                                        <small class="text-muted">{{ exam.questionCount }}ë¬¸í•­ Â· {{ exam.timeLimit }}</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <h6 class="mb-3">ê³¼ì œ</h6>
                <div class="row g-3">
                    <div v-for="assignment in availableAssignments" :key="assignment.id" class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox"
                                           :checked="assessments.assignments.includes(assignment.id)"
                                           @change="$event.target.checked ? addAssignment(assignment.id) : removeAssignment(assignment.id)">
                                    <label class="form-check-label">
                                        <strong>{{ assignment.title }}</strong><br>
                                        <small class="text-muted">{{ assignment.points }}ì  Â· ê¸°í•œ: {{ assignment.dueDate }}</small>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 5ë‹¨ê³„: ìˆ˜ë£Œ ì„¤ì • -->
        <div v-if="currentStep === 5" class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">ğŸ“ ìˆ˜ë£Œ ì„¤ì •</h5>
            </div>
            <div class="card-body">
                <div class="mb-4">
                    <label class="form-label">ìˆ˜ë£Œì¦ í…œí”Œë¦¿ *</label>
                    <select class="form-select" v-model="completionSettings.certificateTemplateId">
                        <option :value="null">í…œí”Œë¦¿ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        <option v-for="template in certificateTemplates" :key="template.id" :value="template.id">
                            {{ template.name }} ({{ template.orientation === 'horizontal' ? 'ê°€ë¡œí˜•' : 'ì„¸ë¡œí˜•' }})
                        </option>
                    </select>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <label class="form-label">ì§„ë„ìœ¨ ê¸°ì¤€ (%)</label>
                        <input type="number" class="form-control" v-model.number="completionSettings.progressRequired" min="0" max="100">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">ì´ì  ê¸°ì¤€ (ì )</label>
                        <input type="number" class="form-control" v-model.number="completionSettings.scoreRequired" min="0" max="100">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">ìˆ˜ë£Œ ì²˜ë¦¬ ë°©ì‹</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" value="auto" v-model="completionSettings.completionType" id="autoCompletion">
                        <label class="form-check-label" for="autoCompletion">
                            ìë™ ìˆ˜ë£Œ (ê¸°ì¤€ ì¶©ì¡± ì‹œ ìë™ ì²˜ë¦¬)
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" value="manual" v-model="completionSettings.completionType" id="manualCompletion">
                        <label class="form-check-label" for="manualCompletion">
                            ìˆ˜ë™ ìˆ˜ë£Œ (ê´€ë¦¬ìê°€ ì§ì ‘ ì²˜ë¦¬)
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- 6ë‹¨ê³„: ê°€ê²© ì„¤ì • -->
        <div v-if="currentStep === 6" class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">ğŸ’° ê°€ê²© ì„¤ì • (ì„ íƒì‚¬í•­)</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning mb-4">
                    <strong>ğŸ’¡ ì°¸ê³ :</strong> ê°€ê²©ì€ ë‚˜ì¤‘ì— íŒë§¤ ê´€ë¦¬ > ìƒí’ˆì—ì„œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>

                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" v-model="pricingEnabled" id="enablePricing">
                    <label class="form-check-label" for="enablePricing">
                        ì§€ê¸ˆ ê°€ê²© ì„¤ì •í•˜ê¸°
                    </label>
                </div>

                <div v-if="pricingEnabled">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">ì •ê°€</label>
                            <input type="number" class="form-control" v-model.number="pricing.price" placeholder="0">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">í• ì¸ê°€</label>
                            <input type="number" class="form-control" v-model.number="pricing.salePrice" placeholder="0">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">íŒë§¤ ì‹œì‘ì¼</label>
                            <input type="date" class="form-control" v-model="pricing.salesStart">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">íŒë§¤ ì¢…ë£Œì¼</label>
                            <input type="date" class="form-control" v-model="pricing.salesEnd">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 7ë‹¨ê³„: ìµœì¢… ê²€í†  -->
        <div v-if="currentStep === 7" class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">âœ… ìµœì¢… ê²€í† </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-success mb-4">
                    <strong>ğŸ‰ ê±°ì˜ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</strong> ì•„ë˜ ë‚´ìš©ì„ í™•ì¸í•˜ê³  ê°•ì¢Œë¥¼ ìƒì„±í•˜ì„¸ìš”.
                </div>

                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="mb-3">ğŸ“‹ ê¸°ë³¸ ì •ë³´</h6>
                                <div class="small mb-2"><strong>ê°•ì¢Œëª…:</strong> {{ basicInfo.title }}</div>
                                <div class="small mb-2"><strong>ì¹´í…Œê³ ë¦¬:</strong> {{ basicInfo.category }}</div>
                                <div class="small mb-2"><strong>ê°•ì‚¬:</strong> {{ basicInfo.instructor }}</div>
                                <div class="small"><strong>ë‚œì´ë„:</strong> {{ basicInfo.level }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="mb-3">ğŸ“š ì»¤ë¦¬í˜ëŸ¼</h6>
                                <div class="small mb-2"><strong>ì„¹ì…˜:</strong> {{ sections.length }}ê°œ</div>
                                <div class="small mb-2"><strong>ì°¨ì‹œ:</strong> {{ totalLessons }}ê°œ</div>
                                <div class="small mb-2"><strong>ì‹œí—˜:</strong> {{ assessments.exams.length }}ê°œ</div>
                                <div class="small"><strong>ê³¼ì œ:</strong> {{ assessments.assignments.length }}ê°œ</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="mb-3">ğŸ“ ìˆ˜ë£Œ ì„¤ì •</h6>
                                <div class="small mb-2"><strong>ì§„ë„ìœ¨:</strong> {{ completionSettings.progressRequired }}%</div>
                                <div class="small mb-2"><strong>ì´ì :</strong> {{ completionSettings.scoreRequired }}ì </div>
                                <div class="small"><strong>ì²˜ë¦¬:</strong> {{ completionSettings.completionType === 'auto' ? 'ìë™' : 'ìˆ˜ë™' }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="mb-3">ğŸ’° ê°€ê²©</h6>
                                <div v-if="pricingEnabled">
                                    <div class="small mb-2"><strong>ì •ê°€:</strong> {{ pricing.price }}ì›</div>
                                    <div class="small"><strong>í• ì¸ê°€:</strong> {{ pricing.salePrice }}ì›</div>
                                </div>
                                <div v-else class="small text-muted">ë¯¸ì„¤ì • (ë‚˜ì¤‘ì— ì„¤ì • ê°€ëŠ¥)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-check mt-4">
                    <input class="form-check-input" type="checkbox" v-model="publishImmediately" id="publishNow">
                    <label class="form-check-label" for="publishNow">
                        <strong>ì¦‰ì‹œ ë°œí–‰í•˜ê¸°</strong>
                        <div class="small text-muted">ì²´í¬í•˜ì§€ ì•Šìœ¼ë©´ ì„ì‹œ ì €ì¥ë˜ë©°, ë‚˜ì¤‘ì— ê°•ì¢Œ ëª©ë¡ì—ì„œ ë°œí–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="card border-0 shadow-sm mt-4">
        <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
                <button class="btn btn-outline-secondary" @click="prevStep" :disabled="currentStep === 1">
                    â† ì´ì „
                </button>
                <div class="d-flex gap-2">
                    <button v-if="canSkipCurrentStep" class="btn btn-outline-secondary" @click="skipStep">
                        ê±´ë„ˆë›°ê¸°
                    </button>
                    <button v-if="currentStep < totalSteps" class="btn btn-primary" @click="nextStep" :disabled="!canProceed">
                        ë‹¤ìŒ â†’
                    </button>
                    <button v-if="currentStep === totalSteps" class="btn btn-success" @click="completeCourse" :disabled="!canProceed">
                        âœ… ì™„ë£Œ
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.wizard-step-indicator {
    flex: 1;
    text-align: center;
    cursor: pointer;
    padding: 10px;
    border-radius: 8px;
    transition: all 0.2s;
}

.wizard-step-indicator:hover {
    background: #f8f9fa;
}

.wizard-step-indicator.active {
    background: #0d6efd;
    color: white;
}

.wizard-step-indicator.completed {
    background: #198754;
    color: white;
}

.step-number {
    font-size: 1.5rem;
    margin-bottom: 4px;
}

.step-label {
    font-size: 0.75rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
</style>
