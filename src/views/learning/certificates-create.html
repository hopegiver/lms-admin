<div class="certificates-create-page">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="mb-1">{{ mode === 'create' ? 'ìƒˆ ìˆ˜ë£Œì¦ í…œí”Œë¦¿' : 'ìˆ˜ë£Œì¦ í…œí”Œë¦¿ ìˆ˜ì •' }}</h4>
            <p class="text-muted mb-0">ìˆ˜ë£Œì¦ í…œí”Œë¦¿ì„ ë””ìì¸í•˜ê³  í•„ë“œë¥¼ ë°°ì¹˜í•©ë‹ˆë‹¤</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary" @click="togglePreview">
                <span class="me-1">ğŸ‘ï¸</span> {{ previewMode ? 'í¸ì§‘ ëª¨ë“œ' : 'ë¯¸ë¦¬ë³´ê¸°' }}
            </button>
            <button class="btn btn-outline-secondary" @click="cancel">ì·¨ì†Œ</button>
            <button class="btn btn-primary" @click="save">
                <span class="me-1">ğŸ’¾</span> {{ mode === 'create' ? 'ìƒì„±' : 'ìˆ˜ì •' }}
            </button>
        </div>
    </div>

    <div class="row g-4">
        <!-- ì™¼ìª½: ì„¤ì • íŒ¨ë„ -->
        <div class="col-lg-4" v-if="!previewMode">
            <!-- ê¸°ë³¸ ì •ë³´ -->
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-header bg-white">
                    <h6 class="mb-0">ğŸ“‹ ê¸°ë³¸ ì •ë³´</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">í…œí”Œë¦¿ ì´ë¦„ *</label>
                        <input type="text" class="form-control" v-model="form.name" placeholder="ì˜ˆ: ê¸°ë³¸ ìˆ˜ë£Œì¦">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ì„¤ëª…</label>
                        <textarea class="form-control" v-model="form.description" rows="2" placeholder="í…œí”Œë¦¿ ì„¤ëª…"></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ìš©ì§€ ë°©í–¥</label>
                        <select class="form-select" v-model="form.orientation">
                            <option value="horizontal">ê°€ë¡œí˜• (Landscape)</option>
                            <option value="vertical">ì„¸ë¡œí˜• (Portrait)</option>
                        </select>
                    </div>
                    <div class="mb-0">
                        <label class="form-label">ìš©ì§€ í¬ê¸°</label>
                        <select class="form-select" v-model="form.size">
                            <option value="A4">A4 (210 Ã— 297 mm)</option>
                            <option value="Letter">Letter (216 Ã— 279 mm)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ë””ìì¸ ì„¤ì • -->
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-header bg-white">
                    <h6 class="mb-0">ğŸ¨ ë””ìì¸</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">ë°°ê²½ ì´ë¯¸ì§€</label>
                        <div v-if="form.backgroundImage" class="mb-2">
                            <img :src="form.backgroundImage" alt="Background" class="img-thumbnail w-100">
                            <button class="btn btn-sm btn-outline-danger w-100 mt-2" @click="removeBackgroundImage">
                                ì´ë¯¸ì§€ ì œê±°
                            </button>
                        </div>
                        <button v-else class="btn btn-outline-secondary w-100" @click="uploadBackgroundImage">
                            <span class="me-1">ğŸ“</span> ì´ë¯¸ì§€ ì—…ë¡œë“œ
                        </button>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ë°°ê²½ìƒ‰</label>
                        <input type="color" class="form-control form-control-color w-100" v-model="form.backgroundColor">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">í…Œë‘ë¦¬ ìŠ¤íƒ€ì¼</label>
                        <select class="form-select" v-model="form.borderStyle">
                            <option value="none">ì—†ìŒ</option>
                            <option value="solid">ì‹¤ì„ </option>
                            <option value="dashed">ì ì„ </option>
                            <option value="dotted">ì </option>
                            <option value="double">ì´ì¤‘ì„ </option>
                        </select>
                    </div>
                    <div class="mb-3" v-if="form.borderStyle !== 'none'">
                        <label class="form-label">í…Œë‘ë¦¬ ìƒ‰ìƒ</label>
                        <input type="color" class="form-control form-control-color w-100" v-model="form.borderColor">
                    </div>
                    <div class="mb-0" v-if="form.borderStyle !== 'none'">
                        <label class="form-label">í…Œë‘ë¦¬ ë‘ê»˜ (px)</label>
                        <input type="number" class="form-control" v-model.number="form.borderWidth" min="1" max="10">
                    </div>
                </div>
            </div>

            <!-- í•„ë“œ ì¶”ê°€ -->
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-header bg-white">
                    <h6 class="mb-0">â• í•„ë“œ ì¶”ê°€</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button v-for="field in availableFields" :key="field.type"
                                class="btn btn-outline-primary btn-sm text-start"
                                @click="addField(field)">
                            <span class="me-2">{{ field.icon }}</span>{{ field.label }}
                        </button>
                    </div>
                </div>
            </div>

            <!-- í•„ë“œ ìƒì„¸ ì„¤ì • -->
            <div class="card border-0 shadow-sm" v-if="selectedField">
                <div class="card-header bg-white">
                    <h6 class="mb-0">âš™ï¸ í•„ë“œ ì„¤ì •</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">í•„ë“œ íƒ€ì…</label>
                        <input type="text" class="form-control" :value="selectedField.label" disabled>
                    </div>
                    <div class="mb-3" v-if="selectedField.type === 'text'">
                        <label class="form-label">í…ìŠ¤íŠ¸ ë‚´ìš©</label>
                        <input type="text" class="form-control" v-model="selectedField.customText" placeholder="í‘œì‹œí•  í…ìŠ¤íŠ¸">
                    </div>
                    <div class="row mb-3">
                        <div class="col-6">
                            <label class="form-label">X ìœ„ì¹˜ (%)</label>
                            <input type="number" class="form-control" v-model.number="selectedField.x" min="0" max="100">
                        </div>
                        <div class="col-6">
                            <label class="form-label">Y ìœ„ì¹˜ (%)</label>
                            <input type="number" class="form-control" v-model.number="selectedField.y" min="0" max="100">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ê¸€ê¼´ í¬ê¸° (px)</label>
                        <input type="number" class="form-control" v-model.number="selectedField.fontSize" min="8" max="72">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ê¸€ê¼´ êµµê¸°</label>
                        <select class="form-select" v-model="selectedField.fontWeight">
                            <option value="normal">ë³´í†µ</option>
                            <option value="bold">êµµê²Œ</option>
                        </select>
                    </div>
                    <div class="mb-0">
                        <label class="form-label">ê¸€ê¼´ ìƒ‰ìƒ</label>
                        <input type="color" class="form-control form-control-color w-100" v-model="selectedField.color">
                    </div>
                </div>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½: ë¯¸ë¦¬ë³´ê¸° ë° í•„ë“œ ëª©ë¡ -->
        <div :class="previewMode ? 'col-12' : 'col-lg-8'">
            <!-- ë¯¸ë¦¬ë³´ê¸° ìº”ë²„ìŠ¤ -->
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-header bg-white">
                    <h6 class="mb-0">ğŸ–¼ï¸ ë¯¸ë¦¬ë³´ê¸°</h6>
                </div>
                <div class="card-body p-4 bg-light">
                    <div class="certificate-preview mx-auto"
                         :class="form.orientation === 'horizontal' ? 'certificate-horizontal' : 'certificate-vertical'"
                         :style="{
                             backgroundColor: form.backgroundColor,
                             borderStyle: form.borderStyle,
                             borderColor: form.borderColor,
                             borderWidth: form.borderWidth + 'px',
                             backgroundImage: form.backgroundImage ? `url(${form.backgroundImage})` : 'none',
                             backgroundSize: 'cover',
                             backgroundPosition: 'center'
                         }">
                        <!-- í•„ë“œ í‘œì‹œ -->
                        <div v-for="(field, index) in form.fields" :key="index"
                             class="certificate-field"
                             :class="{ 'certificate-field-selected': selectedField === field }"
                             :style="{
                                 left: field.x + '%',
                                 top: field.y + '%',
                                 fontSize: field.fontSize + 'px',
                                 fontWeight: field.fontWeight,
                                 color: field.color
                             }"
                             @click="selectField(field)">
                            <span v-if="field.type === 'studentName'">í™ê¸¸ë™</span>
                            <span v-else-if="field.type === 'courseName'">Vue.js ì™„ë²½ ë§ˆìŠ¤í„° ê³¼ì •</span>
                            <span v-else-if="field.type === 'instructor'">ê¹€ê°•ì‚¬</span>
                            <span v-else-if="field.type === 'completionDate'">2024ë…„ 3ì›” 25ì¼</span>
                            <span v-else-if="field.type === 'certificateNumber'">CERT-2024-000001</span>
                            <span v-else-if="field.type === 'issueDate'">2024ë…„ 3ì›” 25ì¼</span>
                            <span v-else-if="field.type === 'organization'">í•œêµ­ì˜¨ë¼ì¸êµìœ¡ì›</span>
                            <span v-else-if="field.type === 'signature'">_______________</span>
                            <span v-else-if="field.type === 'text'">{{ field.customText || 'ì‚¬ìš©ì ì •ì˜ í…ìŠ¤íŠ¸' }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í•„ë“œ ëª©ë¡ -->
            <div class="card border-0 shadow-sm" v-if="!previewMode">
                <div class="card-header bg-white">
                    <h6 class="mb-0">ğŸ“ í•„ë“œ ëª©ë¡ ({{ form.fields.length }}ê°œ)</h6>
                </div>
                <div class="card-body">
                    <div v-if="form.fields.length === 0" class="text-center py-4 text-muted">
                        ì¢Œì¸¡ì—ì„œ í•„ë“œë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”
                    </div>
                    <div v-else class="list-group">
                        <div v-for="(field, index) in form.fields" :key="index"
                             class="list-group-item d-flex justify-content-between align-items-center"
                             :class="{ 'active': selectedField === field }"
                             @click="selectField(field)"
                             style="cursor: pointer;">
                            <div>
                                <span class="me-2">{{ getFieldIcon(field.type) }}</span>
                                <strong>{{ field.label }}</strong>
                                <span class="text-muted small ms-2">
                                    (X: {{ field.x }}%, Y: {{ field.y }}%, {{ field.fontSize }}px)
                                </span>
                            </div>
                            <div class="d-flex gap-1">
                                <button class="btn btn-sm btn-outline-secondary" @click.stop="moveFieldUp(index)" :disabled="index === 0">â–²</button>
                                <button class="btn btn-sm btn-outline-secondary" @click.stop="moveFieldDown(index)" :disabled="index === form.fields.length - 1">â–¼</button>
                                <button class="btn btn-sm btn-outline-danger" @click.stop="removeField(index)">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.certificate-preview {
    position: relative;
    background: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.certificate-horizontal {
    width: 100%;
    max-width: 800px;
    aspect-ratio: 297 / 210;
}

.certificate-vertical {
    width: 100%;
    max-width: 600px;
    aspect-ratio: 210 / 297;
}

.certificate-field {
    position: absolute;
    transform: translate(-50%, -50%);
    cursor: pointer;
    padding: 4px 8px;
    border-radius: 4px;
    transition: all 0.2s;
    white-space: nowrap;
}

.certificate-field:hover {
    background: rgba(13, 110, 253, 0.1);
    outline: 2px solid rgba(13, 110, 253, 0.3);
}

.certificate-field-selected {
    background: rgba(13, 110, 253, 0.15);
    outline: 2px solid rgba(13, 110, 253, 0.5);
}
</style>
