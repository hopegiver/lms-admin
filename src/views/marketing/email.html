<div class="email-sending-page">
    <!-- 페이지 헤더 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="mb-1">이메일 발송</h4>
            <p class="text-muted mb-0">개별 이메일을 빠르게 발송합니다</p>
        </div>
        <button class="btn btn-outline-secondary" @click="navigateTo('/marketing/campaigns')">
            뒤로 가기
        </button>
    </div>

    <div class="row">
        <!-- 왼쪽: 작성 영역 -->
        <div class="col-lg-7">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <!-- 발신자 정보 -->
                    <div class="mb-4">
                        <h6 class="mb-3">발신자 정보</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">발신자명</label>
                                <input type="text" class="form-control" v-model="emailForm.senderName">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">발신 이메일</label>
                                <input type="email" class="form-control" v-model="emailForm.senderEmail">
                            </div>
                            <div class="col-12">
                                <label class="form-label">회신 이메일 (선택)</label>
                                <input type="email" class="form-control" v-model="emailForm.replyTo"
                                       placeholder="비워두면 발신 이메일로 설정됩니다">
                            </div>
                        </div>
                    </div>

                    <hr>

                    <!-- 이메일 내용 -->
                    <div class="mb-4">
                        <h6 class="mb-3">이메일 내용</h6>
                        <div class="mb-3">
                            <label class="form-label">제목 <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" v-model="emailForm.subject"
                                   placeholder="이메일 제목을 입력하세요">
                        </div>
                        <div class="mb-3">
                            <label class="form-label d-flex justify-content-between align-items-center">
                                <span>본문 <span class="text-danger">*</span></span>
                                <div class="btn-group btn-group-sm">
                                    <button type="button" class="btn btn-outline-secondary" @click="insertVariable('이름')">
                                        {{이름}}
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" @click="insertVariable('이메일')">
                                        {{이메일}}
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" @click="insertVariable('강좌명')">
                                        {{강좌명}}
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" @click="insertVariable('진도율')">
                                        {{진도율}}
                                    </button>
                                </div>
                            </label>
                            <textarea class="form-control" rows="12" v-model="emailForm.content"
                                      placeholder="이메일 본문을 입력하세요. 변수 버튼을 사용하여 개인화된 내용을 추가할 수 있습니다."></textarea>
                        </div>
                    </div>

                    <hr>

                    <!-- 수신 대상 -->
                    <div class="mb-4">
                        <h6 class="mb-3">수신 대상 <span class="text-danger">*</span></h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" v-model="emailForm.targetType"
                                   value="all" id="targetAll">
                            <label class="form-check-label" for="targetAll">
                                전체 발송 (5,230명)
                            </label>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="radio" v-model="emailForm.targetType"
                                   value="groups" id="targetGroups">
                            <label class="form-check-label" for="targetGroups">
                                그룹 선택
                            </label>
                        </div>

                        <div v-if="emailForm.targetType === 'groups'" class="ms-4">
                            <div v-for="group in availableGroups" :key="group.id" class="form-check mb-2">
                                <input class="form-check-input" type="checkbox"
                                       :value="group.id" v-model="emailForm.targetGroups"
                                       :id="'group-' + group.id">
                                <label class="form-check-label" :for="'group-' + group.id">
                                    {{ group.name }} <span class="text-muted">({{ group.count.toLocaleString() }}명)</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <!-- 발송 시간 -->
                    <div class="mb-0">
                        <h6 class="mb-3">발송 시간</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" v-model="emailForm.scheduleType"
                                   value="now" id="scheduleNow">
                            <label class="form-check-label" for="scheduleNow">
                                즉시 발송
                            </label>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="radio" v-model="emailForm.scheduleType"
                                   value="schedule" id="scheduleTime">
                            <label class="form-check-label" for="scheduleTime">
                                예약 발송
                            </label>
                        </div>
                        <div v-if="emailForm.scheduleType === 'schedule'" class="row g-2 ms-4">
                            <div class="col-md-6">
                                <input type="date" class="form-control" v-model="emailForm.scheduleDate">
                            </div>
                            <div class="col-md-6">
                                <input type="time" class="form-control" v-model="emailForm.scheduleTime">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 오른쪽: 미리보기 영역 -->
        <div class="col-lg-5">
            <div class="card border-0 shadow-sm sticky-top" style="top: 80px;">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0">미리보기</h6>
                </div>
                <div class="card-body">
                    <!-- 이메일 미리보기 -->
                    <div class="border rounded p-3 mb-4 bg-light" style="min-height: 400px;">
                        <div class="mb-3 pb-3 border-bottom">
                            <div class="small text-muted mb-1">발신자</div>
                            <div class="fw-medium">{{ emailForm.senderName || '(미입력)' }} &lt;{{ emailForm.senderEmail || '(미입력)' }}&gt;</div>
                        </div>
                        <div class="mb-3 pb-3 border-bottom">
                            <div class="small text-muted mb-1">제목</div>
                            <div class="fw-bold">{{ emailForm.subject || '(제목을 입력하세요)' }}</div>
                        </div>
                        <div style="white-space: pre-wrap; line-height: 1.6;">
                            {{ previewContent || '(본문을 입력하세요)' }}
                        </div>
                    </div>

                    <hr>

                    <!-- 발송 정보 -->
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted small">발송 대상</span>
                            <span class="fw-bold text-primary fs-5">{{ targetCount.toLocaleString() }}명</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="text-muted small">예상 비용</span>
                            <span class="fw-medium">₩{{ estimatedCost.toLocaleString() }}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small">발송 방식</span>
                            <span class="fw-medium">
                                <span v-if="emailForm.scheduleType === 'now'">즉시 발송</span>
                                <span v-else-if="emailForm.scheduleDate && emailForm.scheduleTime">
                                    {{ emailForm.scheduleDate }} {{ emailForm.scheduleTime }}
                                </span>
                                <span v-else class="text-muted">(미설정)</span>
                            </span>
                        </div>
                    </div>

                    <div class="alert alert-info small mb-3">
                        발송 후 발송 내역에서 결과를 확인할 수 있습니다.
                    </div>

                    <button class="btn btn-primary w-100 btn-lg" @click="sendEmail">
                        <span class="me-1">📧</span> 이메일 발송
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
