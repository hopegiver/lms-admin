<div class="campaign-detail-page">
    <!-- ë¡œë”© ìƒíƒœ -->
    <div v-if="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
        </div>
    </div>

    <!-- ìº í˜ì¸ì´ ì—†ëŠ” ê²½ìš° -->
    <div v-else-if="!campaign" class="text-center py-5">
        <div class="text-muted mb-3">ìº í˜ì¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
        <button class="btn btn-primary" @click="goBack">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <!-- ìº í˜ì¸ ìƒì„¸ -->
    <div v-else>
        <!-- í˜ì´ì§€ í—¤ë” -->
        <div class="d-flex justify-content-between align-items-start mb-4">
            <div class="flex-grow-1">
                <div class="d-flex align-items-center gap-2 mb-2">
                    <button class="btn btn-sm btn-outline-secondary" @click="goBack">
                        â† ëª©ë¡
                    </button>
                    <h4 class="mb-0">{{ campaign.name }}</h4>
                    <span class="badge" :class="statusInfo.badge">
                        {{ statusInfo.label }}
                    </span>
                </div>
                <p class="text-muted mb-0">{{ campaign.description }}</p>
            </div>
            <div class="d-flex gap-2">
                <button v-if="canPerformAction('pause')" class="btn btn-warning" @click="pauseCampaign">
                    â¸ï¸ ì¼ì‹œì¤‘ì§€
                </button>
                <button v-if="canPerformAction('resume')" class="btn btn-success" @click="resumeCampaign">
                    â–¶ï¸ ì¬ê°œ
                </button>
                <button v-if="canPerformAction('edit')" class="btn btn-primary" @click="editCampaign">
                    âœï¸ ìˆ˜ì •
                </button>
                <button v-if="canPerformAction('duplicate')" class="btn btn-outline-primary" @click="duplicateCampaign">
                    ğŸ“‹ ë³µì‚¬
                </button>
                <button v-if="canPerformAction('retry')" class="btn btn-outline-warning" @click="retryCampaign">
                    ğŸ”„ ì¬ì‹œë„
                </button>
                <button v-if="canPerformAction('delete')" class="btn btn-outline-danger" @click="confirmDelete">
                    ğŸ—‘ï¸ ì‚­ì œ
                </button>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-8">
                <!-- ë°œì†¡ í˜„í™© -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white py-3">
                        <h6 class="mb-0">ë°œì†¡ í˜„í™©</h6>
                    </div>
                    <div class="card-body">
                        <!-- ì§„í–‰ë¥  -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-muted">ë°œì†¡ ì§„í–‰ë¥ </span>
                                <span class="fw-medium">{{ campaign.sentCount.toLocaleString() }} / {{ campaign.targetCount.toLocaleString() }}ëª…</span>
                            </div>
                            <div class="progress" style="height: 24px;">
                                <div class="progress-bar" :class="`bg-${channelInfo.color}`"
                                     :style="`width: ${progressPercentage}%`">
                                    {{ progressPercentage }}%
                                </div>
                            </div>
                        </div>

                        <!-- í†µê³„ ì¹´ë“œ -->
                        <div class="row g-3">
                            <div class="col-md-3">
                                <div class="text-center p-3 bg-light rounded">
                                    <div class="text-muted small mb-1">ë°œì†¡ ì™„ë£Œ</div>
                                    <div class="h4 mb-0 text-primary">{{ campaign.sentCount.toLocaleString() }}</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center p-3 bg-light rounded">
                                    <div class="text-muted small mb-1">ì„±ê³µ</div>
                                    <div class="h4 mb-0 text-success">{{ campaign.successCount.toLocaleString() }}</div>
                                    <div class="small text-muted">{{ successRate }}%</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center p-3 bg-light rounded">
                                    <div class="text-muted small mb-1">ì‹¤íŒ¨</div>
                                    <div class="h4 mb-0 text-danger">{{ campaign.failCount.toLocaleString() }}</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="text-center p-3 bg-light rounded">
                                    <div class="text-muted small mb-1">ì˜ˆìƒ ë¹„ìš©</div>
                                    <div class="h5 mb-0">â‚©{{ campaign.estimatedCost.toLocaleString() }}</div>
                                </div>
                            </div>
                        </div>

                        <!-- ì„±ê³¼ ì§€í‘œ (ì´ë©”ì¼/í‘¸ì‹œë§Œ) -->
                        <div v-if="campaign.channel === 'email' || campaign.channel === 'push'" class="row g-3 mt-1">
                            <div class="col-md-6">
                                <div class="text-center p-3 border rounded">
                                    <div class="text-muted small mb-1">ì˜¤í”ˆìœ¨</div>
                                    <div class="h4 mb-0">{{ campaign.openRate }}%</div>
                                    <div class="small text-muted">{{ campaign.openCount.toLocaleString() }}ëª… ì—´ëŒ</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="text-center p-3 border rounded">
                                    <div class="text-muted small mb-1">í´ë¦­ìœ¨</div>
                                    <div class="h4 mb-0">{{ campaign.clickRate }}%</div>
                                    <div class="small text-muted">{{ campaign.clickCount.toLocaleString() }}ëª… í´ë¦­</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ë°œì†¡ ë‚´ìš© -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white py-3">
                        <h6 class="mb-0">ë°œì†¡ ë‚´ìš©</h6>
                    </div>
                    <div class="card-body">
                        <!-- ì´ë©”ì¼ -->
                        <div v-if="campaign.channel === 'email'">
                            <div class="mb-3">
                                <div class="text-muted small mb-1">ì œëª©</div>
                                <div class="fw-medium">{{ campaign.content.subject }}</div>
                            </div>
                            <div class="mb-3">
                                <div class="text-muted small mb-1">ë°œì‹ ì</div>
                                <div>{{ campaign.content.senderName }} &lt;{{ campaign.content.senderEmail }}&gt;</div>
                            </div>
                            <div>
                                <div class="text-muted small mb-2">ë³¸ë¬¸</div>
                                <div class="border rounded p-3 bg-light" style="white-space: pre-wrap; font-family: monospace;">{{ campaign.content.body }}</div>
                            </div>
                        </div>

                        <!-- SMS -->
                        <div v-else-if="campaign.channel === 'sms'">
                            <div class="border rounded p-3 bg-light" style="white-space: pre-wrap;">{{ campaign.content.message }}</div>
                        </div>

                        <!-- ì•Œë¦¼í†¡ -->
                        <div v-else-if="campaign.channel === 'kakao'">
                            <div class="mb-3">
                                <div class="text-muted small mb-1">í…œí”Œë¦¿</div>
                                <div class="fw-medium">{{ campaign.content.templateName }} ({{ campaign.content.templateCode }})</div>
                            </div>
                            <div>
                                <div class="text-muted small mb-2">ë³€ìˆ˜ ê°’</div>
                                <div class="border rounded p-3 bg-light">
                                    <div v-for="(value, key) in campaign.content.variables" :key="key" class="mb-2">
                                        <span class="badge bg-secondary">#{{'{'}}{{ key }}{{'}'}}}</span>
                                        <span class="ms-2">{{ value }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- í‘¸ì‹œ -->
                        <div v-else-if="campaign.channel === 'push'">
                            <div class="mb-3">
                                <div class="text-muted small mb-1">ì œëª©</div>
                                <div class="fw-medium">{{ campaign.content.title }}</div>
                            </div>
                            <div>
                                <div class="text-muted small mb-1">ë‚´ìš©</div>
                                <div>{{ campaign.content.message }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- í™œë™ ë¡œê·¸ -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white py-3">
                        <h6 class="mb-0">í™œë™ ë¡œê·¸</h6>
                    </div>
                    <div class="card-body">
                        <div v-if="activityLog.length === 0" class="text-center text-muted py-3">
                            í™œë™ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
                        </div>
                        <div v-else class="timeline">
                            <div v-for="(log, index) in activityLog" :key="index" class="timeline-item mb-3">
                                <div class="d-flex gap-3">
                                    <div class="text-center" style="width: 40px;">
                                        <span class="fs-4">{{ getActivityIcon(log.type) }}</span>
                                    </div>
                                    <div class="flex-grow-1">
                                        <div class="fw-medium">{{ log.message }}</div>
                                        <div class="small text-muted">{{ log.time }}</div>
                                    </div>
                                </div>
                                <hr v-if="index < activityLog.length - 1" class="my-3">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <!-- ìº í˜ì¸ ì •ë³´ -->
                <div class="card border-0 shadow-sm mb-4 sticky-top" style="top: 80px;">
                    <div class="card-header bg-white py-3">
                        <h6 class="mb-0">ìº í˜ì¸ ì •ë³´</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="text-muted small mb-1">ë°œì†¡ ì±„ë„</div>
                            <div class="d-flex align-items-center gap-2">
                                <span class="fs-4">{{ channelInfo.icon }}</span>
                                <span class="fw-medium">{{ channelInfo.name }}</span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="text-muted small mb-1">ë°œì†¡ ëŒ€ìƒ</div>
                            <div v-if="campaign.targetType === 'all'" class="fw-medium">
                                ì „ì²´ íšŒì›
                            </div>
                            <div v-else-if="campaign.targetType === 'groups'" class="fw-medium">
                                <div v-for="group in campaign.targetGroups" :key="group" class="badge bg-secondary me-1 mb-1">
                                    {{ group }}
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="text-muted small mb-1">ë°œì†¡ ë°©ì‹</div>
                            <div class="fw-medium">
                                <span v-if="campaign.scheduleType === 'now'">ì¦‰ì‹œ ë°œì†¡</span>
                                <span v-else>ì˜ˆì•½ ë°œì†¡</span>
                            </div>
                        </div>

                        <div v-if="campaign.scheduledAt" class="mb-3">
                            <div class="text-muted small mb-1">ì˜ˆì•½ ì‹œê°„</div>
                            <div class="fw-medium">{{ campaign.scheduledAt }}</div>
                        </div>

                        <div v-if="campaign.startedAt" class="mb-3">
                            <div class="text-muted small mb-1">ë°œì†¡ ì‹œì‘</div>
                            <div class="fw-medium">{{ campaign.startedAt }}</div>
                        </div>

                        <div v-if="campaign.completedAt" class="mb-3">
                            <div class="text-muted small mb-1">ë°œì†¡ ì™„ë£Œ</div>
                            <div class="fw-medium">{{ campaign.completedAt }}</div>
                        </div>

                        <div class="mb-3">
                            <div class="text-muted small mb-1">ìƒì„±ì¼</div>
                            <div>{{ campaign.createdAt }}</div>
                        </div>

                        <div class="mb-0">
                            <div class="text-muted small mb-1">ì‘ì„±ì</div>
                            <div>{{ campaign.createdBy }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
    <div v-if="showDeleteModal" class="modal d-block" tabindex="-1" style="background: rgba(0,0,0,0.5);">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ìº í˜ì¸ ì‚­ì œ</h5>
                    <button type="button" class="btn-close" @click="showDeleteModal = false"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-0">ì •ë§ë¡œ ì´ ìº í˜ì¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @click="showDeleteModal = false">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-danger" @click="deleteCampaign">ì‚­ì œ</button>
                </div>
            </div>
        </div>
    </div>
</div>
