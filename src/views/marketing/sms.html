<div class="sms-sending-page">
    <!-- 페이지 헤더 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="mb-1">SMS 발송</h4>
            <p class="text-muted mb-0">SMS 캠페인을 생성하고 발송합니다</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary" @click="saveDraft">
                <span class="me-1">💾</span> 임시저장
            </button>
            <button class="btn btn-outline-secondary" @click="navigateTo('/marketing/campaigns')">
                취소
            </button>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- 기본 정보 -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0">기본 정보</h6>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">캠페인명 <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" v-model="smsForm.campaignName"
                                   placeholder="예: 신규 강좌 안내">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">발신번호</label>
                            <select class="form-select" v-model="smsForm.senderNumber">
                                <option value="1588-0000">1588-0000</option>
                                <option value="1588-0001">1588-0001</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 메시지 작성 -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">메시지 작성</h6>
                        <span class="badge" :class="messageType === 'SMS' ? 'bg-success' : 'bg-primary'">
                            {{ messageType }}
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <textarea class="form-control mb-2" rows="8" v-model="smsForm.message"
                              :maxlength="maxLength"
                              placeholder="메시지를 입력하세요"></textarea>
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn btn-sm btn-outline-secondary" @click="insertVariable('이름')">이름</button>
                            <button class="btn btn-sm btn-outline-secondary" @click="insertVariable('강좌명')">강좌명</button>
                            <button class="btn btn-sm btn-outline-secondary" @click="insertVariable('진도율')">진도율</button>
                        </div>
                        <div class="text-muted small">
                            {{ messageLength }} / {{ maxLength }}자 ({{ messageByte }}byte)
                        </div>
                    </div>
                    <div class="alert alert-info small mt-3 mb-0">
                        <strong>안내:</strong>
                        <ul class="mb-0 ps-3">
                            <li>90byte 이하: SMS (20원/건)</li>
                            <li>90byte 초과: LMS (30원/건, 최대 2000자)</li>
                            <li>한글은 2byte, 영문/숫자는 1byte로 계산됩니다</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 수신 대상 -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0">수신 대상</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" v-model="smsForm.targetType"
                                   value="all" id="targetAll">
                            <label class="form-check-label" for="targetAll">
                                전체 발송 (5,230명)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" v-model="smsForm.targetType"
                                   value="groups" id="targetGroups">
                            <label class="form-check-label" for="targetGroups">
                                그룹 선택
                            </label>
                        </div>
                    </div>

                    <div v-if="smsForm.targetType === 'groups'" class="mt-3">
                        <label class="form-label">수신 그룹 선택</label>
                        <div v-for="group in availableGroups" :key="group.id" class="form-check mb-2">
                            <input class="form-check-input" type="checkbox"
                                   :value="group.id" v-model="smsForm.targetGroups"
                                   :id="'group-' + group.id">
                            <label class="form-check-label" :for="'group-' + group.id">
                                {{ group.name }} <span class="text-muted">({{ group.count.toLocaleString() }}명)</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 발송 시간 설정 -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0">발송 시간 설정</h6>
                </div>
                <div class="card-body">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="radio" v-model="smsForm.scheduleType"
                               value="now" id="scheduleNow">
                        <label class="form-check-label" for="scheduleNow">
                            즉시 발송
                        </label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="radio" v-model="smsForm.scheduleType"
                               value="schedule" id="scheduleTime">
                        <label class="form-check-label" for="scheduleTime">
                            예약 발송
                        </label>
                    </div>
                    <div v-if="smsForm.scheduleType === 'schedule'" class="row g-2 ms-4">
                        <div class="col-md-6">
                            <input type="date" class="form-control" v-model="smsForm.scheduleDate">
                        </div>
                        <div class="col-md-6">
                            <input type="time" class="form-control" v-model="smsForm.scheduleTime">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- 미리보기 및 발송 -->
            <div class="card border-0 shadow-sm sticky-top" style="top: 80px;">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0">미리보기</h6>
                </div>
                <div class="card-body">
                    <div class="sms-preview border rounded p-3 mb-3 bg-light" style="min-height: 200px;">
                        <div class="small text-muted mb-2">발신: {{ smsForm.senderNumber }}</div>
                        <div style="white-space: pre-wrap;">{{ smsForm.message || '(메시지를 입력하세요)' }}</div>
                    </div>

                    <hr>

                    <div class="mb-3">
                        <div class="text-muted small mb-1">예상 발송 수</div>
                        <div class="h4 text-primary">{{ targetCount.toLocaleString() }}명</div>
                    </div>
                    <div class="mb-3">
                        <div class="text-muted small mb-1">메시지 타입</div>
                        <div class="h5">{{ messageType }}</div>
                    </div>
                    <div class="mb-4">
                        <div class="text-muted small mb-1">예상 비용</div>
                        <div class="h5">₩{{ estimatedCost.toLocaleString() }}</div>
                    </div>

                    <button class="btn btn-primary w-100" @click="sendSms">
                        <span class="me-1">💬</span> SMS 발송
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
