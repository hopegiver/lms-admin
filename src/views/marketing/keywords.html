<div class="keyword-management-page">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="mb-1">í‚¤ì›Œë“œ ê´€ë¦¬</h4>
            <p class="text-muted mb-0">ê²€ìƒ‰ì—”ì§„ í‚¤ì›Œë“œ ìˆœìœ„ë¥¼ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-success" @click="checkAllRanks" :disabled="isChecking">
                <span class="me-1">ğŸ”„</span>
                {{ isChecking ? 'ì¡°íšŒì¤‘...' : 'ì „ì²´ ìˆœìœ„ ì¡°íšŒ' }}
            </button>
            <button class="btn btn-primary" @click="openAddModal">
                <span class="me-1">â•</span> í‚¤ì›Œë“œ ì¶”ê°€
            </button>
        </div>
    </div>

    <!-- ìš”ì•½ ì¹´ë“œ -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="text-muted small mb-1">ì „ì²´ í‚¤ì›Œë“œ</div>
                            <div class="h3 mb-0">{{ summary.total }}</div>
                        </div>
                        <div class="fs-1">ğŸ“Š</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="text-muted small mb-1">TOP 10</div>
                            <div class="h3 mb-0 text-success">{{ summary.top10 }}</div>
                        </div>
                        <div class="fs-1">ğŸ†</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="text-muted small mb-1">ìˆœìœ„ ìƒìŠ¹</div>
                            <div class="h3 mb-0 text-primary">{{ summary.improved }}</div>
                        </div>
                        <div class="fs-1">ğŸ“ˆ</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="text-muted small mb-1">ìˆœìœ„ í•˜ë½</div>
                            <div class="h3 mb-0 text-danger">{{ summary.declined }}</div>
                        </div>
                        <div class="fs-1">ğŸ“‰</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í•„í„° ë° ê²€ìƒ‰ -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <input type="text" class="form-control" v-model="searchQuery" placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰...">
                </div>
                <div class="col-md-3">
                    <select class="form-select" v-model="filterEngine">
                        <option value="">ì „ì²´ ê²€ìƒ‰ì—”ì§„</option>
                        <option value="naver">ë„¤ì´ë²„</option>
                        <option value="google">êµ¬ê¸€</option>
                        <option value="daum">ë‹¤ìŒ</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" v-model="filterStatus">
                        <option value="">ì „ì²´ ìƒíƒœ</option>
                        <option value="active">í™œì„±</option>
                        <option value="inactive">ë¹„í™œì„±</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-outline-secondary w-100" @click="resetFilters">
                        ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- í‚¤ì›Œë“œ ëª©ë¡ -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white py-3">
            <h6 class="mb-0">ë“±ë¡ í‚¤ì›Œë“œ ({{ filteredKeywords.length }})</h6>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th>í‚¤ì›Œë“œ</th>
                            <th class="text-center">ê²€ìƒ‰ì—”ì§„</th>
                            <th class="text-center">í˜„ì¬ ìˆœìœ„</th>
                            <th class="text-center">ë³€ë™</th>
                            <th class="text-center">ìµœê³  ìˆœìœ„</th>
                            <th class="text-center">ìƒíƒœ</th>
                            <th>ìµœê·¼ ì¡°íšŒ</th>
                            <th class="text-center">ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-if="filteredKeywords.length === 0">
                            <td colspan="8" class="text-center text-muted py-5">
                                ë“±ë¡ëœ í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤
                            </td>
                        </tr>
                        <tr v-for="keyword in filteredKeywords" :key="keyword.id">
                            <td>
                                <div class="fw-medium">{{ keyword.keyword }}</div>
                                <div class="small text-muted text-truncate" style="max-width: 200px;">
                                    {{ keyword.targetUrl }}
                                </div>
                            </td>
                            <td class="text-center">
                                <span class="fs-5">{{ getSearchEngineIcon(keyword.searchEngine) }}</span>
                                <div class="small text-muted">{{ getSearchEngineLabel(keyword.searchEngine) }}</div>
                            </td>
                            <td class="text-center">
                                <span v-if="keyword.currentRank" class="badge" :class="keyword.currentRank <= 10 ? 'bg-success' : keyword.currentRank <= 20 ? 'bg-warning' : 'bg-secondary'">
                                    {{ keyword.currentRank }}ìœ„
                                </span>
                                <span v-else class="text-muted">â€”</span>
                            </td>
                            <td class="text-center">
                                <span :class="getRankChangeClass(keyword)" class="fw-medium">
                                    {{ getRankChangeIcon(keyword) }}
                                    <span v-if="getRankChange(keyword) !== null">
                                        {{ Math.abs(getRankChange(keyword)) }}
                                    </span>
                                </span>
                            </td>
                            <td class="text-center">
                                <span v-if="keyword.bestRank" class="text-primary fw-medium">
                                    {{ keyword.bestRank }}ìœ„
                                </span>
                                <span v-else class="text-muted">â€”</span>
                            </td>
                            <td class="text-center">
                                <span class="badge" :class="keyword.status === 'active' ? 'bg-success' : 'bg-secondary'">
                                    {{ keyword.status === 'active' ? 'í™œì„±' : 'ë¹„í™œì„±' }}
                                </span>
                            </td>
                            <td>
                                <span v-if="keyword.lastChecked" class="small">{{ keyword.lastChecked }}</span>
                                <span v-else class="text-muted small">ë¯¸ì¡°íšŒ</span>
                            </td>
                            <td class="text-center">
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary" @click="checkSingleRank(keyword)" title="ìˆœìœ„ ì¡°íšŒ">
                                        ğŸ”„
                                    </button>
                                    <button class="btn btn-outline-secondary" @click="viewDetail(keyword)" title="ìƒì„¸ë³´ê¸°">
                                        ğŸ“Š
                                    </button>
                                    <button class="btn btn-outline-danger" @click="deleteKeyword(keyword)" title="ì‚­ì œ">
                                        ğŸ—‘ï¸
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- í‚¤ì›Œë“œ ì¶”ê°€ ëª¨ë‹¬ -->
    <div v-if="showAddModal" class="modal d-block" tabindex="-1" style="background: rgba(0,0,0,0.5);">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">í‚¤ì›Œë“œ ì¶”ê°€</h5>
                    <button type="button" class="btn-close" @click="closeAddModal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">í‚¤ì›Œë“œ <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" v-model="newKeyword.keyword"
                               placeholder="ì˜ˆ: Vue.js ê°•ì¢Œ">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ê²€ìƒ‰ì—”ì§„ <span class="text-danger">*</span></label>
                        <select class="form-select" v-model="newKeyword.searchEngine">
                            <option value="naver">ë„¤ì´ë²„</option>
                            <option value="google">êµ¬ê¸€</option>
                            <option value="daum">ë‹¤ìŒ</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ëª©í‘œ URL <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" v-model="newKeyword.targetUrl"
                               placeholder="ì˜ˆ: https://example.com/courses/vuejs">
                        <div class="form-text">ìˆœìœ„ë¥¼ í™•ì¸í•  í˜ì´ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @click="closeAddModal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-primary" @click="addKeyword">ë“±ë¡</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒì„¸ë³´ê¸° ëª¨ë‹¬ -->
    <div v-if="showDetailModal && selectedKeyword" class="modal d-block" tabindex="-1" style="background: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{ selectedKeyword.keyword }} - ìˆœìœ„ ì¶”ì´</h5>
                    <button type="button" class="btn-close" @click="closeDetailModal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <div class="small text-muted mb-1">ê²€ìƒ‰ì—”ì§„</div>
                                    <div class="h5 mb-0">
                                        {{ getSearchEngineIcon(selectedKeyword.searchEngine) }}
                                        {{ getSearchEngineLabel(selectedKeyword.searchEngine) }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <div class="small text-muted mb-1">ëª©í‘œ URL</div>
                                    <div class="h6 mb-0 text-truncate">{{ selectedKeyword.targetUrl }}</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card border-0 bg-light">
                                <div class="card-body text-center">
                                    <div class="small text-muted mb-1">í˜„ì¬ ìˆœìœ„</div>
                                    <div class="h3 mb-0" :class="selectedKeyword.currentRank <= 10 ? 'text-success' : 'text-muted'">
                                        {{ selectedKeyword.currentRank ? selectedKeyword.currentRank + 'ìœ„' : 'â€”' }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-0 bg-light">
                                <div class="card-body text-center">
                                    <div class="small text-muted mb-1">ìµœê³  ìˆœìœ„</div>
                                    <div class="h3 mb-0 text-primary">
                                        {{ selectedKeyword.bestRank ? selectedKeyword.bestRank + 'ìœ„' : 'â€”' }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card border-0 bg-light">
                                <div class="card-body text-center">
                                    <div class="small text-muted mb-1">ë³€ë™</div>
                                    <div class="h3 mb-0" :class="getRankChangeClass(selectedKeyword)">
                                        {{ getRankChangeIcon(selectedKeyword) }}
                                        <span v-if="getRankChange(selectedKeyword) !== null">
                                            {{ Math.abs(getRankChange(selectedKeyword)) }}
                                        </span>
                                        <span v-else>â€”</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card border-0 bg-light">
                        <div class="card-header bg-white">
                            <h6 class="mb-0">ìµœê·¼ ìˆœìœ„ ì¶”ì´</h6>
                        </div>
                        <div class="card-body">
                            <div v-if="selectedKeyword.history.length > 0" class="table-responsive">
                                <table class="table table-sm mb-0">
                                    <thead>
                                        <tr>
                                            <th>ë‚ ì§œ</th>
                                            <th class="text-center">ìˆœìœ„</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(record, index) in selectedKeyword.history" :key="index">
                                            <td>{{ record.date }}</td>
                                            <td class="text-center">
                                                <span v-if="record.rank" class="badge" :class="record.rank <= 10 ? 'bg-success' : record.rank <= 20 ? 'bg-warning' : 'bg-secondary'">
                                                    {{ record.rank }}ìœ„
                                                </span>
                                                <span v-else class="text-muted">â€”</span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div v-else class="text-center text-muted py-4">
                                ìˆœìœ„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @click="closeDetailModal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>
</div>
