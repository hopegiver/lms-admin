<div class="send-history-page">
    <!-- 페이지 헤더 -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h4 class="mb-1">발송 내역</h4>
            <p class="text-muted mb-0">개별 발송 내역을 확인합니다 (캠페인 발송은 캠페인 관리에서 확인)</p>
        </div>
    </div>

    <!-- 필터 및 검색 -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <input type="text" class="form-control" v-model="searchQuery" placeholder="제목 검색...">
                </div>
                <div class="col-md-3">
                    <select class="form-select" v-model="filterChannel">
                        <option value="">전체 채널</option>
                        <option value="email">이메일</option>
                        <option value="sms">SMS</option>
                        <option value="kakao">알림톡</option>
                        <option value="push">푸시</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" v-model="filterStatus">
                        <option value="">전체 상태</option>
                        <option value="sending">발송중</option>
                        <option value="completed">완료</option>
                        <option value="failed">실패</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-outline-secondary w-100" @click="resetFilters">
                        초기화
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 발송 내역 목록 -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white py-3">
            <h6 class="mb-0">발송 내역 ({{ filteredHistory.length }})</h6>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th>제목</th>
                            <th class="text-center">채널</th>
                            <th class="text-center">상태</th>
                            <th class="text-center">대상자</th>
                            <th class="text-center">발송 완료</th>
                            <th class="text-center">성공/실패</th>
                            <th class="text-center">오픈율</th>
                            <th class="text-center">클릭율</th>
                            <th>발송 시간</th>
                            <th class="text-center">작업</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-if="filteredHistory.length === 0">
                            <td colspan="10" class="text-center text-muted py-5">
                                발송 내역이 없습니다
                            </td>
                        </tr>
                        <tr v-for="item in filteredHistory" :key="item.id" style="cursor: pointer;" @click="viewDetail(item)">
                            <td>
                                <div class="fw-medium">{{ item.title }}</div>
                            </td>
                            <td class="text-center">
                                <span class="fs-5">{{ getChannelIcon(item.channel) }}</span>
                                <div class="small text-muted">{{ getChannelLabel(item.channel) }}</div>
                            </td>
                            <td class="text-center">
                                <span class="badge" :class="getStatusBadgeClass(item.status)">
                                    {{ getStatusLabel(item.status) }}
                                </span>
                            </td>
                            <td class="text-center">{{ item.targetCount.toLocaleString() }}명</td>
                            <td class="text-center">
                                {{ item.sentCount.toLocaleString() }}명
                                <div class="small text-muted">
                                    {{ ((item.sentCount / item.targetCount) * 100).toFixed(1) }}%
                                </div>
                            </td>
                            <td class="text-center">
                                <span class="text-success">{{ item.successCount.toLocaleString() }}</span> /
                                <span class="text-danger">{{ item.failCount.toLocaleString() }}</span>
                            </td>
                            <td class="text-center">
                                <span v-if="item.channel === 'email' || item.channel === 'push'">
                                    {{ item.openCount > 0 ? ((item.openCount / item.successCount) * 100).toFixed(1) + '%' : '-' }}
                                </span>
                                <span v-else class="text-muted">-</span>
                            </td>
                            <td class="text-center">
                                <span v-if="item.channel === 'email' || item.channel === 'push'">
                                    {{ item.clickCount > 0 ? ((item.clickCount / item.successCount) * 100).toFixed(1) + '%' : '-' }}
                                </span>
                                <span v-else class="text-muted">-</span>
                            </td>
                            <td>{{ item.sentAt }}</td>
                            <td class="text-center" @click.stop>
                                <button class="btn btn-sm btn-outline-secondary" @click="viewDetail(item)">
                                    상세
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
